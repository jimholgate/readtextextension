<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE script:module PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "module.dtd">
<script:module xmlns:script="http://openoffice.org/2000/script" script:name="TTS_Utilities" script:language="StarBasic">REM  *****  BASIC  *****
OPTION EXPLICIT

Sub OK_MouseUp(Event As Object)
	&apos; This Sub uses the current dialog settings without dismissing
	&apos; the dialog If you right click the OK button.
	Dim msgs() As Variant
	Dim errorCode As Integer 
	If Event.Buttons AND com.sun.star.awt.MouseButton.RIGHT Then
		ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,&quot;&quot;)
	Elseif Event.Buttons AND com.sun.star.awt.MouseButton.MIDDLE Then
		ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,f_dlgSpeechSetup.GetControl(&quot;CommandButton1&quot;).model.Label)
	Endif
End Sub

Sub Cancel_MouseUp(Event As Object)
	Dim msgs() As Variant
	Dim errorCode As Integer 
	If Event.Buttons AND com.sun.star.awt.MouseButton.MIDDLE Then
		ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,f_dlgSpeechSetup.GetControl(&quot;CommandButton2&quot;).model.Label)
	Endif
End Sub

Sub Reset_MouseUp(Event As Object)
	Dim msgs() As Variant
	Dim errorCode As Integer 
	If Event.Buttons AND com.sun.star.awt.MouseButton.MIDDLE Then
		ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,f_dlgSpeechSetup.GetControl(&quot;CommandButton4&quot;).model.Label)
	ElseIf Event.Buttons AND com.sun.star.awt.MouseButton.LEFT Then
		resetSpeech()
		
	Endif
End Sub

Sub About_MouseUp(Event As Object)
	Dim msgs() As Variant
	Dim errorCode As Integer 
	If Event.Buttons AND com.sun.star.awt.MouseButton.MIDDLE Then
		ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,f_dlgSpeechSetup.GetControl(&quot;CommandButton3&quot;).model.Label)
	Else 
		aboutReadTextDialog()
	Endif
End Sub

Sub UseFestival_MouseUp(Event As Object)
	Dim msgs() As Variant
	Dim errorCode As Integer 
	If Event.Buttons AND com.sun.star.awt.MouseButton.MIDDLE Then
		ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,f_dlgSpeechSetup.GetControl(&quot;FrameControl1&quot;).model.Label &amp; &quot;,&quot; &amp; f_dlgSpeechSetup.GetControl(&quot;OptionButton1&quot;).model.Label)
	Endif
End Sub

Sub Label1_MouseUp(Event As Object)
	Dim msgs() As Variant
	Dim errorCode As Integer 
	If Event.Buttons AND com.sun.star.awt.MouseButton.MIDDLE Then
		ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,f_dlgSpeechSetup.GetControl(&quot;Label1&quot;).model.Label)
	Endif
End Sub

Sub Label2_MouseUp(Event As Object)
	Dim msgs() As Variant
	Dim errorCode As Integer 
	If Event.Buttons AND com.sun.star.awt.MouseButton.MIDDLE Then
		ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,f_dlgSpeechSetup.GetControl(&quot;Label2&quot;).model.Label)
	Endif
End Sub

Sub UseExternal_MouseUp(Event As Object)
	Dim msgs() As Variant
	Dim errorCode As Integer 
	If Event.Buttons AND com.sun.star.awt.MouseButton.MIDDLE Then
		ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,f_dlgSpeechSetup.GetControl(&quot;FrameControl1&quot;).model.Label  &amp; &quot;,&quot; &amp; f_dlgSpeechSetup.GetControl(&quot;OptionButton2&quot;).model.Label)
	Endif
End Sub

Sub UseWeb_MouseUp(Event As Object)
	Dim msgs() As Variant
	Dim errorCode As Integer 
	If Event.Buttons AND com.sun.star.awt.MouseButton.MIDDLE Then
		ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,f_dlgSpeechSetup.GetControl(&quot;FrameControl1&quot;).model.Label  &amp; &quot;,&quot; &amp;  f_dlgSpeechSetup.GetControl(&quot;OptionButton3&quot;).model.Label)
	Endif
End Sub

Sub UseAlwaysShow_MouseUp(Event As Object)
	Dim msgs() As Variant
	Dim errorCode As Integer 
	If Event.Buttons AND com.sun.star.awt.MouseButton.MIDDLE Then
		ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,f_dlgSpeechSetup.GetControl(&quot;FrameControl2&quot;).model.Label  &amp; &quot;,&quot; &amp;  f_dlgSpeechSetup.GetControl(&quot;CheckBox1&quot;).model.Label)
	Endif
End Sub

Sub AboutButton_MouseUp(Event As Object)
	Dim msgs() As Variant
	Dim errorCode As Integer 
	If Event.Buttons Then
		If fileExists(fsMyTempLock) Then
			resetSpeechDispatcher
		Else
			ttsActuate(fvCurrentDialogConfig(),msgs(),errorCode,fsAbout())
		Endif
	Endif
End Sub

Function fbHelpIsInstalled as Boolean
	Dim sA as String
	sA=fsPathSettings(&quot;Help&quot;) &amp; &quot;/&quot;
	If fileExists( sA &amp; fsGetLanguage) Then
		fbHelpIsInstalled=True
	Elseif fileExists(sA &amp; &quot;en&quot;) Then
		fbHelpIsInstalled=True
	Elseif fileExists(sA &amp; &quot;fr&quot;) Then
		fbHelpIsInstalled=True
	Elseif fileExists(sA &amp; &quot;de&quot;) Then
		fbHelpIsInstalled=True
	Else
		fbHelpIsInstalled=False
	Endif
End Function

Function soundsDirectory() As String
	&apos;This Function returns the application sound gallery location
	Dim strA As String
	Dim intA As Integer
	strA=fsPathSettings(&quot;Gallery&quot;)
	intA=Instr(strA,&quot;;&quot;)
	If intA &lt;&gt; 0 Then
		strA=Left(strA,intA - 1) &apos; We don&apos;t want the semi-colon or the String that follows it
	Endif
	soundsDirectory=ConvertFromURL(strA &amp; &quot;/sounds/&quot;)
End Function

Function fsGetTextSelection() As String
	Dim oDoc   As Object
	Dim oSelection As Object
	Dim sSelectedText As String
	Dim n As Integer
	On Error Goto TEXTSELECTERROR
	oDoc=thisComponent
	If oDoc.SupportsService(&quot;com.sun.star.sheet.SpreadsheetDocument&quot;) Then
		sSelectedText=fsRetrieveCalcActiveCellText()
	Elseif oDoc.supportsService(&quot;com.sun.star.presentation.PresentationDocument&quot;) or oDoc.supportsService(&quot;com.sun.star.drawing.DrawingDocument&quot;) Then
		sSelectedText=fsDrawText()
	Elseif oDoc.supportsService(&quot;com.sun.star.text.TextDocument&quot;) or oDoc.supportsService(&quot;com.sun.star.text.WebDocument&quot;) or oDoc.supportsService(&quot;com.sun.star.text.GlobalDocument&quot;) Then
		oSelection=oDoc.getCurrentSelection()
		sSelectedText=&quot;&quot;  	
		If oSelection.supportsService(&quot;com.sun.star.text.TextRanges&quot;) Then
			For n=0 To(oSelection.getCount() - 1)
				sSelectedText=sSelectedText &amp; &quot; &quot; &amp; oSelection.getByIndex(n).getString()
			Next
		Else 
			sSelectedText=oSelection.getByIndex(0).getString()
		Endif
		If sSelectedText=&quot; &quot; Then
			sSelectedText=fsgetCursorWord()
		Endif
	Else &apos;unsupported document format
		sSelectedText=&quot;&quot;  
	Endif
	fsGetTextSelection=Trim(sSelectedText)
	Exit Function
	TEXTSELECTERROR:
	fsGetTextSelection=&quot;&quot;
End Function

Function WinSpeechProgramPath() As String
	&apos; 2011-03-14
	&apos; Always default to wscript. 
	&apos; The dialog shows all compatible SAPI5 voices
	&apos; SAPI5 can&apos;t use Microsoft Speech Server voices
	Dim s1 As String
	If fileExists(&quot;C:\Windows\SysWOW64\wscript.exe&quot;) Then
		s1=&quot;C:\Windows\SysWOW64\wscript.exe&quot;
	Else
		s1=&quot;C:\WINDOWS\system32\wscript.exe&quot;
	Endif
	WinSpeechProgramPath=s1
End Function

Function WinSpeechArgument() As String
	&apos;OOo For Windows always default to wscript.exe
	Dim s1 As String
	s1= &quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot; &quot;&quot;(TMP)&quot;&quot;&quot;
	WinSpeechArgument=s1
End Function

Sub dialog1Combo2ShowSAPIChoices(oDialog)
	&apos; Determine which SAPI voices are installed, then
	&apos; populate the Combo Box with the names of the voices. This script is only
	&apos; invoked If you show dialog1 And you use TTS_WSCRIPT_VBS As the speech method
	Dim Sapi as Object
	Dim n as Integer
	Dim aLineOfText As String,myScriptPath As String
	Dim n1 As Integer,s1 As String,oComboBox As Variant
	Dim sProgram As String,myTextPath As String
	Set Sapi=CreateObject(&quot;Sapi.SpVoice&quot;)
	REM get control
	oComboBox=oDialog.getControl(&quot;ComboBox2&quot;)
	REM first remove all old items from the list
	n1=oComboBox.getItemCount()
	oComboBox.removeItems( 0,n1)
	n=0
	While n&lt;Sapi.GetVoices.Count
		s1=Sapi.GetVoices.Item(n).GetDescription
		For n1=10 To -10 step -2
			oComboBox.addItem( &quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot; &amp; _
			&quot; /voice:&quot;&quot;&quot; &amp; s1 &amp; &quot;&quot;&quot; /rate:&quot; &amp; Trim(n1) &amp; &quot; &quot;&quot;(TMP)&quot;&quot;&quot;,0)
		Next
		n=n+1
	Wend
	On Error Goto 0
	For n1=10 To -10 step -2
		oComboBox.addItem( &quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot; &amp; _
		&quot; /language:&quot;&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;&quot;&quot; &amp; _
		&quot; /rate:&quot; &amp; Trim(n1) &amp; &quot; &quot;&quot;(TMP)&quot;&quot;&quot;,0)
	Next
	If fileExists(fsOptDirectory() &amp; &quot;oggenc.exe&quot;) or fileExists(fsOptDirectory() &amp; &quot;oggenc2.exe&quot;) Then
		s1=&quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot; &amp; _
		&quot; /language:&quot;&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;&quot;&quot; &amp; _
		&quot; /use-optional-app:&quot;&quot;True&quot;&quot;&quot; &amp; _
		&quot; /soundfile:&quot;&quot;(HOME)(NOW).ogg&quot;&quot;&quot; &amp; _
			&quot; &quot;&quot;(TMP)&quot;&quot;&quot; 
		oComboBox.addItem(s1,0)
	EndIf
	If fileExists(fsOptDirectory() &amp; &quot;lame.exe&quot;) Then
		s1=&quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot; &amp; _
		&quot; /language:&quot;&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;&quot;&quot; &amp; _
		&quot; /use-optional-app:&quot;&quot;True&quot;&quot;&quot; &amp; _
		&quot; /soundfile:&quot;&quot;(HOME)(NOW).mp3&quot;&quot;&quot; &amp; _
			&quot; &quot;&quot;(TMP)&quot;&quot;&quot; 
		oComboBox.addItem(s1,0)
	EndIf

	If fileExists(fsOptDirectory() &amp; &quot;faac.exe&quot;) or fileExists(fsOptDirectory() &amp; &quot;neroAacEnc.exe&quot;) Then
		s1=&quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot; &amp; _
		&quot; /language:&quot;&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;&quot;&quot; &amp; _
		&quot; /use-optional-app:&quot;&quot;True&quot;&quot;&quot; &amp; _
		&quot; /soundfile:&quot;&quot;(HOME)(NOW).m4a&quot;&quot;&quot; &amp; _
			&quot; &quot;&quot;(TMP)&quot;&quot;&quot; 
		oComboBox.addItem(s1,0)
	EndIf
	If fileExists(fsOptDirectory() &amp; &quot;flac.exe&quot;)  Then
		s1=&quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot; &amp; _
		&quot; /language:&quot;&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;&quot;&quot; &amp; _
		&quot; /use-optional-app:&quot;&quot;True&quot;&quot;&quot; &amp; _
		&quot; /soundfile:&quot;&quot;(HOME)(NOW).flac&quot;&quot;&quot; &amp; _
			&quot; &quot;&quot;(TMP)&quot;&quot;&quot; 
		oComboBox.addItem(s1,0)
	EndIf
	If fileExists(fsProgramDirectory() &amp; &quot;iTunes&quot;) or fileExists(fsProgramDirectoryx86() &amp; &quot;iTunes&quot;) Then
		s1=&quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot; &amp; _
		&quot; /language:&quot;&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;&quot;&quot; &amp; _
		&quot; /soundfile:&quot;&quot;(HOME)(NOW).aif&quot;&quot;&quot; &amp; _
			&quot; &quot;&quot;(TMP)&quot;&quot;&quot; 
		oComboBox.addItem(s1,0)
		s1=&quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot; &amp; _
		&quot; /language:&quot;&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;&quot;&quot; &amp; _
		&quot; /soundfile:&quot;&quot;(HOME)(NOW).m4a&quot;&quot;&quot; &amp; _
			&quot; &quot;&quot;(TMP)&quot;&quot;&quot; 
		oComboBox.addItem(s1,0)
	EndIf
	s1=&quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot; &amp; _
	&quot; /language:&quot;&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;&quot;&quot; &amp; _
	&quot; /soundfile:&quot;&quot;(HOME)(NOW).wav&quot;&quot;&quot; &amp; _
		&quot; &quot;&quot;(TMP)&quot;&quot;&quot; 
	oComboBox.addItem(s1,0)
	s1=&quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot; &amp; _
	&quot; /language:&quot;&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;&quot;&quot; &amp; _
		&quot; &quot;&quot;(TMP)&quot;&quot;&quot; 
	oComboBox.addItem(s1,0)
	
	s1=&quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot; &amp; _
		&quot; &quot;&quot;(TMP)&quot;&quot;&quot; 
	oComboBox.addItem(s1,0)
	If fileExists(myTextPath) Then
		Kill myTextPath
	Endif
	Exit Sub
	FichierKO:
	Resume FichierKO2
	FichierKO2:
	On Error Resume Next
End Sub

function fsMacVoice(n, optional s2)
	dim s1 as string
	dim a1
	if ismissing (s2) then
		s2 = fsSelectionLanguageAndRegion(true)
	endif
	select case s2
		case &quot;ar-SA&quot;
			s1 = &quot;Tarik&quot;
		case &quot;cs-CZ&quot;
			s1 = &quot;Zuzana&quot;
		case &quot;da-DK&quot;
			s1 = &quot;Sara&quot;
		case &quot;de-DE&quot;,&quot;de-AT&quot;,&quot;de-CH&quot;,&quot;de-LU&quot;,&quot;de-LI&quot;,&quot;de-BE&quot;
			s1 = &quot;Anna&quot;
		case &quot;el-GR&quot;
			s1 = &quot;Melina&quot;
		case &quot;en-AU&quot;,&quot;en-NZ&quot;
			s1 = &quot;Karen,Lee&quot;
		case &quot;en-GB&quot;,&quot;en-BD&quot;,&quot;en-BS&quot;,&quot;en-GH&quot;,&quot;en-HK&quot;,&quot;en-JM&quot;,&quot;en-TT&quot;
			s1 = &quot;Daniel,Fiona&quot;
		case &quot;en-IE&quot;
			s1 = &quot;Moira&quot;
		case &quot;en-IN&quot;,&quot;en-PK&quot;
			s1 = &quot;Veena&quot;
		case &quot;en-US&quot;, &quot;en-CA&quot;
			s1 = &quot;Agnes,Albert,Alex,Bad News,Bahh,Bells,Boing,Bruce,Bubbles,Cellos,Deranged,Fred,Good News,Hysterical,Junior,Kathy,Pipe Organ,Princess,Ralph,Samantha,Trinoids,Vicki,Victoria,Whisper,Zarvox&quot;
		case &quot;en-ZA&quot;
			s1 = &quot;Tessa&quot;
		case &quot;es-AR&quot;
			s1 = &quot;Diego&quot;
		case &quot;es-ES&quot;
			s1 = &quot;Monica&quot;
		case &quot;es-MX&quot;
			s1 = &quot;Angelica,Javier,Paulina&quot;
		case &quot;fi-FI&quot;
			s1 = &quot;Satu&quot;
		case &quot;fr-CA&quot;
			s1 = &quot;Amelie,Felix&quot;
		case &quot;fr-FR&quot;,&quot;fr-BE&quot;
			s1 = &quot;Audrey,Thomas,Virginie&quot;
		case &quot;he-IL&quot;
			s1 = &quot;Carmit&quot;
		case &quot;hi-IN&quot;
			s1 = &quot;Lekha&quot;
		case &quot;hu-HU&quot;
			s1 = &quot;Mariska&quot;
		case &quot;id-ID&quot;
			s1 = &quot;Damayanti&quot;
		case &quot;it-IT&quot;
			s1 = &quot;Alice&quot;
		case &quot;ja-JP&quot;
			s1 = &quot;Kyoko&quot;
		case &quot;ko-KR&quot;, &quot;ko-KP&quot;
			s1 = &quot;Yuna&quot;
		case &quot;nb-NO&quot;
			s1 = &quot;Nora&quot;
		case &quot;nl-BE&quot;
			s1 = &quot;Ellen&quot;
		case &quot;nl-NL&quot;
			s1 = &quot;Xander&quot;
		case &quot;pl-PL&quot;
			s1 = &quot;Zosia&quot;
		case &quot;pt-BR&quot;
			s1 = &quot;Luciana&quot;
		case &quot;pt-PT&quot;
			s1 = &quot;Joana&quot;
		case &quot;ro-RO&quot;
			s1 = &quot;Ioana&quot;
		case &quot;ru-RU&quot;
			s1 = &quot;Milena&quot;
		case &quot;sk-SK&quot;
			s1 = &quot;Laura&quot;
		case &quot;sv-SE&quot;
			s1 = &quot;Alva&quot;
		case &quot;th-TH&quot;
			s1 = &quot;Kanya&quot;
		case &quot;tr-TR&quot;
			s1 = &quot;Yelda&quot;
		case &quot;zh-CN&quot;
			s1 = &quot;Ting-Ting&quot;
		case &quot;zh-HK&quot;
			s1 = &quot;Sin-ji&quot;
		case &quot;zh-TW&quot;
			s1 = &quot;Mei-Jia,Ya-Ling&quot;
		case else
			s1 = &quot;Alex,Daniel,Kathy,Lee,Vicki&quot;
	end select
	s1 = s1 &amp; &quot;,,&quot;
	a1 = split(s1, &quot;,&quot;)
	fsMacVoice = a1(n)
end function
Sub dialog1Combo2ShowSAYChoices(oDialog)
	&apos;Mac OSX say
	Dim n, o As Integer
	Dim s1 As String
	Dim s2 As String
	Dim aA
	Dim oComboBox As Variant
	REM get control
	oComboBox=oDialog.getControl(&quot;ComboBox2&quot;)
	REM first remove all old items from the list
	n=oComboBox.getItemCount()
	oComboBox.removeItems( 0,n)
	s2= &quot;.m4a,.aif&quot;
	aA = split(s2, &quot;,&quot;)
	For n=lbound(aA) To ubound(aA)
			s1=&quot;-o &quot;&quot;(HOME)(NOW)&quot; &amp; s2(n) &amp; &quot;&quot;&quot; -f &quot;&quot;(TMP)&quot;&quot;&quot;
			oComboBox.addItem(s1,0)
	Next 
	n=0
	for n = 0 to 40
		if fsMacVoice(n) = &quot;&quot; then
			exit for
		else
			s1=&quot;-v &quot;&quot;&quot; &amp; fsMacVoice(n) &amp; &quot;&quot;&quot; -f &quot;&quot;(TMP)&quot;&quot;&quot;
			oComboBox.addItem(s1,0)
			n=n+1
		endif
	next

	s1=&quot;-f &quot;&quot;(TMP)&quot;&quot;&quot; 
	oComboBox.addItem(s1,0)
End Sub

Sub dialog1Combo2ShowAppleScriptChoices(oDialog)
	&apos;Mac OSX open or osascript
	Dim n As Integer
	Dim s1, s2 As String
	Dim a1, a2
	Dim CR
	CR = chr$(10)
	Dim oComboBox As Variant
	oComboBox=oDialog.getControl(&quot;ComboBox2&quot;)
	n=oComboBox.getItemCount()
	oComboBox.removeItems( 0,n)
	s2 = &quot;&quot;
	if fbHaveFfmpeg() then
		s2 = s2 &amp; &quot;.webm&quot;&quot; &quot;&quot;(MY_IMAGE)&quot;&quot; &quot;&quot;640x480,.webm&quot;&quot; &quot;&quot;(MY_IMAGE),.wav,.ogg,.mp4&quot;&quot; &quot;&quot;(MY_IMAGE)&quot;&quot; &quot;&quot;640x480,.mp4&quot;&quot; &quot;&quot;(MY_IMAGE),.mp4,.mp3,&quot;
	endif
	s2 = s2 &amp; &quot;.m4a&quot;&quot;,.aif&quot;&quot;&quot;
	a2 = split(s2, &quot;,&quot;)
	s1= &quot;_SYSTEM_VOICE)&quot;&quot;&quot; &amp; CR &amp; _
			&quot;_AIRPLAY_QUICKLY)&quot;&quot;&quot; &amp; CR &amp; _
			&quot;_AIRPLAY_SLOWLY)&quot;&quot;&quot; &amp; CR &amp; _
			&quot;_AIRPLAY)&quot;&quot;&quot; &amp; CR		
	for n = lbound(a2) to ubound(a2)		
		s1 = s1 &amp; &quot;_SYSTEM_VOICE)&quot;&quot; &quot;&quot;(HOME)(NOW)&quot; &amp; a2(n) &amp; &quot;&quot;&quot;&quot; &amp; CR &amp; _
			&quot;_QUICKLY)&quot;&quot; &quot;&quot;(HOME)(NOW)&quot; &amp; a2(n) &amp; &quot;&quot;&quot;&quot; &amp; CR &amp; _
			&quot;_SLOWLY)&quot;&quot; &quot;&quot;(HOME)(NOW)&quot; &amp; a2(n) &amp; &quot;&quot;&quot;&quot; &amp; CR &amp; _
			&quot;)&quot;&quot; &quot;&quot;(HOME)(NOW)&quot; &amp; a2(n) &amp; &quot;&quot;&quot;&quot; &amp; CR
	next
	s1 = s1 &amp; &quot;_SYSTEM_VOICE)&quot;&quot;&quot; &amp; CR &amp; _
		&quot;_SLOWLY)&quot;&quot;&quot; &amp; CR &amp; _
		&quot;_QUICKLY)&quot;&quot;&quot; &amp; CR &amp; _
		&quot;)&quot;&quot;&quot;
	a1=Split(s1,CR)
	for n = lbound(a1) to ubound(a1)
		oComboBox.addItem(&quot;&quot;&quot;(SAY_APPLESCRIPT&quot; &amp; a1(n),0)
	next
End Sub

Sub dialog1Combo2ShowESPEAKChoices(oDialog)
	&apos;espeak
	Dim n As Integer
	Dim s1 As String
	Dim s2(3) As String
	Dim s3 As String
	Dim s4 As String
	Dim n2 As Integer
	Dim oComboBox As Variant
	Dim sLanguage as String
	sLanguage=Lcase(fsGetLanguage())
	REM get control
	oComboBox=oDialog.getControl(&quot;ComboBox2&quot;)
	REM first remove all old items from the list
	n=oComboBox.getItemCount()
	oComboBox.removeItems(0,n)
	s3=&quot;&quot;
	s2(0)=&quot; -b 1 -s 130 -f &apos;(TMP)&apos; -w &apos;(HOME)(NOW).wav&apos;&quot;
	s2(1)=&quot; -b 1 -f &apos;(TMP)&apos; -w &apos;(HOME)(NOW).wav&apos;&quot;
	s2(2)=&quot; -b 1 -s 130 -f &apos;(TMP)&apos;&quot;
	s2(3)=&quot; -b 1 -f &apos;(TMP)&apos;&quot;
    For n=0 To 3
		&apos;English
		s1=s3 &amp; &quot;-v en-us&quot; &amp; s2(n)
		oComboBox.addItem(s1,0)
		s1=s3 &amp; &quot;-v en&quot; &amp; s2(n)
		oComboBox.addItem(s1,0)
		Select Case sLanguage
		Case &quot;es&quot;
		    s1=s3 &amp; &quot;-v es-mx&quot; &amp; s2(n)
		    oComboBox.addItem(s1,0) 
			s1=s3 &amp; &quot;-v es-la&quot; &amp; s2(n)
			oComboBox.addItem(s1,0) 
			s1=s3 &amp; &quot;-v es&quot; &amp; s2(n)
			oComboBox.addItem(s1,0)  	
		Case &quot;fr&quot;
			s1=s3 &amp; &quot;-v fr-be&quot; &amp; s2(n)
			oComboBox.addItem(s1,0) 
			s1=s3 &amp; &quot;-v fr&quot; &amp; s2(n)
			oComboBox.addItem(s1,0)   
		Case &quot;nb&quot;,&quot;nn&quot;,&quot;no&quot;
			&apos; Norway
			s1=s3 &amp; &quot;-v no&quot; &amp; s2(n)
			oComboBox.addItem(s1,0)
		Case &quot;pt&quot;
			&apos; Portugal And Brazil
			s1=s3 &amp; &quot;-v pt-pt&quot; &amp; s2(n)
			oComboBox.addItem(s1,0)
			s1=s3 &amp; &quot;-v pt&quot; &amp; s2(n)
			oComboBox.addItem(s1,0)
		Case &quot;zh&quot;
			s1=s3 &amp; &quot;-v zh-yue&quot; &amp; s2(n)
			oComboBox.addItem(s1,0)
			s1=s3 &amp; &quot;-v zh&quot; &amp; s2(n)
			oComboBox.addItem(s1,0)
		Case &quot;af&quot;,&quot;bs&quot;,&quot;ca&quot;,&quot;cs&quot;,&quot;cy&quot;,&quot;da&quot;,&quot;de&quot;,&quot;el&quot;,&quot;eo&quot;,&quot;fi&quot;,&quot;hi&quot;,&quot;hr&quot;,&quot;hu&quot;,_
			&quot;hy&quot;,&quot;id&quot;,&quot;is&quot;,&quot;it&quot;,&quot;ku&quot;,&quot;la&quot;,&quot;lv&quot;,&quot;mk&quot;,&quot;nl&quot;,&quot;pl&quot;,&quot;ro&quot;,&quot;ru&quot;,&quot;sk&quot;,&quot;sq&quot;,_
			&quot;sr&quot;,&quot;sv&quot;,&quot;sw&quot;,&quot;ta&quot;,&quot;tr&quot;,&quot;vi&quot;
			s1=s3 &amp; &quot;-v &quot; &amp; sLanguage &amp; s2(n)
			oComboBox.addItem(s1,0)  
		Case Else  
		End Select
		If fileExists( &quot;/usr/bin/mbrola&quot;) or fileExists(fsProgramDirectory() &amp; &quot;eSpeak\espeak-data\mbrola\&quot;) or fileExists(fsProgramDirectoryx86() &amp; &quot;eSpeak\espeak-data\mbrola\&quot;) Then
			s1=s3 &amp; &quot;-v mb-(SELECTION_LANGUAGE_CODE)1 &quot; &amp; s2(n)
			oComboBox.addItem(s1,0)
		Endif
		For n2=0 To fiCountEspeakMbrolaLanguage()
			s4=fsGetEspeakMbrolaLanguage(n2,1)
			If fileExists( &quot;/usr/share/mbrola/&quot; &amp; s4 &amp; &quot;/&quot; &amp; s4) or _
				fileExists( &quot;/usr/local/share/mbrola/&quot; &amp; s4 &amp; &quot;/&quot; &amp; s4) or _
				fileExists( &quot;/usr/share/mbrola/voices/&quot; &amp; s4) or _
				fileExists( &quot;/usr/local/share/mbrola/voices/&quot; &amp; s4) or _
				fileExists(fsProgramDirectory() &amp; &quot;eSpeak\espeak-data\mbrola\&quot; &amp; s4) or _
				fileExists(fsProgramDirectoryx86() &amp; &quot;eSpeak\espeak-data\mbrola\&quot; &amp; s4) Then
				s1=s3 &amp; &quot;-v mb-&quot; &amp; s4 &amp; &quot; &quot; &amp; s2(n)
				oComboBox.addItem(s1,0)
			Endif
		Next
		s1=s3 &amp; s2(n)
		oComboBox.addItem(s1,0)
	Next
End Sub

Sub dialog1Combo2ShowMEDIAChoices(oDialog)
	&apos;Show some URLs
	Dim n1 As Integer
	Dim s1 As String
	Dim oComboBox As Variant
	REM get control
	oComboBox=oDialog.getControl(&quot;ComboBox2&quot;)
	REM first remove all old items from the list
	n1=oComboBox.getItemCount()
	oComboBox.removeItems( 0,n1)
	s1=&quot;http://translate.google.com/translate_tts?tl=(SELECTION_LANGUAGE_COUNTRY_CODE)&amp;q=(OOO_WEBTEXTSMALL)&quot;
	oComboBox.addItem(s1,0)
	s1=&quot;http://translate.google.com/translate_tts?tl=(LANGUAGE_CODE)&amp;q=(OOO_WEBTEXTSMALL)&quot;
	oComboBox.addItem(s1,0)
	s1=&quot;http://wa.eguidedog.net/cgi-bin/ekho.pl?voice=en-us&amp;speedDelta=0&amp;pitchDelta=0&amp;volumeDelta=0&amp;text=(OOO_WEBTEXT)...&quot;
	oComboBox.addItem(s1,0)
	s1=&quot;http://wa.eguidedog.net/cgi-bin/ekho.pl?voice=EkhoMandarin&amp;speedDelta=0&amp;pitchDelta=0&amp;volumeDelta=0&amp;text=(OOO_WEBTEXT)...&quot;
	oComboBox.addItem(s1,0)
	s1=&quot;http://wa.eguidedog.net/cgi-bin/ekho.pl?voice=EkhoCantonese&amp;speedDelta=0&amp;pitchDelta=0&amp;volumeDelta=0&amp;text=(OOO_WEBTEXT)...&quot;
	oComboBox.addItem(s1,0)
	s1=&quot;http://wa.eguidedog.net/cgi-bin/ekho.pl?voice=(SELECTION_LANGUAGE_CODE)&amp;speedDelta=0&amp;pitchDelta=0&amp;volumeDelta=0&amp;text=(OOO_WEBTEXT)...&quot;
	oComboBox.addItem(s1,0)
	s1=&quot;http://wa.eguidedog.net/cgi-bin/ekho.pl?voice=(LANGUAGE_CODE)&amp;speedDelta=0&amp;pitchDelta=0&amp;volumeDelta=0&amp;text=(OOO_WEBTEXT)...&quot;
	oComboBox.addItem(s1,0)
End Sub

Sub dialog1Combo2ShowFESTIVALChoices(oDialog)
	&apos;Show some URLs
	Dim n1 As Integer
	Dim s1 As String
	Dim oComboBox As Variant
	REM get control
	oComboBox=oDialog.getControl(&quot;ComboBox2&quot;)
	REM first remove all old items from the list
	n1=oComboBox.getItemCount()
	oComboBox.removeItems( 0,n1)
	s1=&quot;--language welsh --tts &quot;&quot;(TMP)&quot;&quot;&quot;
	oComboBox.addItem(s1,0)
	s1=&quot;--language spanish --tts &quot;&quot;(TMP)&quot;&quot;&quot;
	oComboBox.addItem(s1,0)
	s1=&quot;--language english --tts &quot;&quot;(TMP)&quot;&quot;&quot;
	oComboBox.addItem(s1,0)
	s1=&quot;--tts &quot;&quot;(TMP)&quot;&quot;&quot;
	oComboBox.addItem(s1,0)
End Sub

Sub dialog1Combo2ShowTEXT2WAVEChoices(oDialog)
	&apos;Show this Festival script options
	Dim n1 As Integer
	Dim s1 As String
	Dim oComboBox As Variant
	REM get control
	oComboBox=oDialog.getControl(&quot;ComboBox2&quot;)
	REM first remove all old items from the list
	n1=oComboBox.getItemCount()
	oComboBox.removeItems( 0,n1)
	s1=&quot;&quot;&quot;(TMP)&quot;&quot; -otype snd -o &quot;&quot;(HOME)(NOW).wav&quot;&quot;&quot;
	oComboBox.addItem(s1,0)
	s1=&quot;&quot;&quot;(TMP)&quot;&quot; -o &quot;&quot;(HOME)(NOW).wav&quot;&quot;&quot;
	oComboBox.addItem(s1,0)
End Sub

Sub dialog1Combo1ShowFESTIVALScripts(oDialog)
	Dim n As Integer
	Dim n2 As Integer
	Dim s1 as String
	Dim s2(4) As String
	Dim oComboBox As Variant
	REM get control
	oComboBox=oDialog.getControl(&quot;ComboBox1&quot;)
	REM first remove all old items from the list
	n=oComboBox.getItemCount()
	oComboBox.removeItems(0,n)
	s2(4)=&quot;( tts &quot;&quot;(TMP)&quot;&quot; nil)(quit)&quot;
	s2(3)=&quot;(SayText &quot;&quot;The selection says: &quot;&quot;)( tts &quot;&quot;(TMP)&quot;&quot; nil)(quit)&quot;
	s2(2)=&quot;(SayText &quot;&quot;On (WEEKDAY), (DATE) at (TIME), (AUTHOR) said: &quot;&quot;)( tts &quot;&quot;(TMP)&quot;&quot; nil)(quit)&quot;
	s2(1)=&quot;(set! utt1 (Utterance Phrase ((Phrase ((name B))The (selected ((EMPH 3)))text )(Phrase ((name BB)) says: ))))(utt.synth utt1)(utt.play utt1)( tts &quot;&quot;(TMP)&quot;&quot; nil)(quit)&quot;
	if fileExists (soundsDirectory() &amp; &quot;apert.wav&quot;) then 
		s2(0)=&quot;(set! utt1 (Utterance Wave (SOUND_GALLERY)apert.wav))(utt.synth utt1)(utt.play utt1)(tts &quot;&quot;(TMP)&quot;&quot; nil)(quit)&quot;
	else
		s2(0)=&quot;(set! utt1 (Utterance Wave /usr/share/sounds/alsa/Noise.wav))(utt.synth utt1)(utt.play utt1)(tts &quot;&quot;(TMP)&quot;&quot; nil)(quit)&quot;
	endif
	For n2 = 0 to fiCountFestivalDirectory
		For n=0 To 4
			if fileExists (fsFestivalDirectory (n2)) Then
				if n = 4 or instr(fsFestivalDirectory (n2) ,&quot;english&quot;) &lt;&gt; 0 then
					s1= &quot;(voice_&quot; &amp; fsFestivalVoice(n2) &amp; &quot;)&quot;
					oComboBox.addItem(s1 &amp; s2(n),0)
				Endif
			Endif
		Next
	Next
	n= 4
	oComboBox.addItem(s2(n),0)
End Sub

Sub dialog1Combo2ShowMyPythonChoices(oDialog)
	&apos;Show the python script options
	Dim n As Integer
	Dim n2 As Integer
	Dim s1 As String
	Dim s2(10) As String
	Dim s3 As String
	Dim s4 As String
	Dim a1
	Dim CR As String
	Dim oComboBox As Variant
	CR=Chr$(10)
	s1 = &quot;&quot;
	s3 = &quot;&quot;
	s4 = &quot;&quot;
	Dim sLanguage as String
	sLanguage=Lcase(fsGetLanguage())
	select case fsGetOS()
	case &quot;WINDOWS&quot; &apos;Show examples
		s1=s1 &amp; CR &amp; &quot;-c &quot;&quot;import os; os.startfile(&apos;http://chart.apis.google.com/chart?chs=350x350&amp;cht=qr&amp;chl=(OOO_WEBTEXT)&apos;)&quot;&quot;&quot;
		s1=s1 &amp; CR &amp; &quot;-c &quot;&quot;import os; os.startfile(&apos;http://translate.google.com/translate_tts?tl=(SELECTION_LANGUAGE_COUNTRY_CODE)&amp;q=(OOO_WEBTEXTSMALL)&apos;)&quot;&quot;&quot;
		s1=s1 &amp; CR &amp; &quot;&quot;&quot;(OS_PY)&quot;&quot; &quot;&quot;notepad &apos;(TMP)&apos;&quot;&quot;&quot;
	case &quot;OSX&quot;,&quot;MAC&quot; &apos; Python silently fails on OSX
		exit sub
	end select
	oComboBox=oDialog.getControl(&quot;ComboBox2&quot;)
	n=oComboBox.getItemCount()
	oComboBox.removeItems(0,n)
	If fileExists( fsProgramDirectory() &amp; &quot;Python\Lib\site-packages\pyttsx&quot;) Or fileExists( fsProgramDirectoryx86() &amp; &quot;Python\Lib\site-packages\pyttsx&quot;) Then
		s2(0)=&quot; --rate 90 &quot; 
		s2(1)=&quot; --rate 60 &quot;
		s2(2)=&quot; --rate 30 &quot;
		s2(3)=&quot; --rate 0 &quot;
		s2(4)=&quot; --rate -30 &quot;
		s2(5)=&quot; --rate -60 &quot;
		s2(6)=&quot; --rate -90 &quot;
		s2(7)=&quot; &quot;
		For n=0 To 7
			s1=s1 &amp; CR &amp; &quot;&quot;&quot;(PYTTSX_READ_TEXT_PY)&quot;&quot;&quot;&amp; s2(n) &amp; &quot;&quot;&quot;(TMP)&quot;&quot;&quot;
		Next
	Endif
	if Instr(Lcase(f_dlgSpeechSetup.GetControl(&quot;FileControl2&quot;).Model.Text),&quot;bin/python3&quot;) &gt; 0 Then
		If fileExists(&quot;/usr/lib/python3/dist-packages/speechd/client.py&quot;) Then
			s2(0)=&quot;MALE3&quot; 
			s2(1)=&quot;MALE2&quot;
			s2(2)=&quot;MALE1&quot;
			s2(3)=&quot;FEMALE3&quot;
			s2(4)=&quot;FEMALE2&quot;
			s2(5)=&quot;FEMALE1&quot;
			s2(6)=&quot;CHILD_MALE&quot;
			s2(7)=&quot;CHILD_FEMALE&quot;
			For n=0 To 7
				s1=s1 &amp; CR &amp; &quot;&quot;&quot;(SPD_READ_TEXT_PY)&quot;&quot;&quot;&amp; _
				&quot; --language &quot;&quot;(SELECTION_LANGUAGE_CODE)&quot;&quot; --voice &quot;&quot;&quot;&amp; s2(n) &amp; _
				&quot;&quot;&quot; --rate &quot;&quot;-30&quot;&quot; &quot;&quot;(TMP)&quot;&quot;&quot;
				
				s1=s1 &amp; CR &amp; &quot;&quot;&quot;(SPD_READ_TEXT_PY)&quot;&quot;&quot;&amp; _
				&quot; --language &quot;&quot;(SELECTION_LANGUAGE_CODE)&quot;&quot; --voice &quot;&quot;&quot;&amp; s2(n) &amp; _
				&quot;&quot;&quot; &quot;&quot;(TMP)&quot;&quot;&quot;
			Next
			s1=s1 &amp; CR &amp; &quot;&quot;&quot;(SPD_READ_TEXT_PY)&quot;&quot;&quot;&amp; _
			&quot; --language &quot;&quot;(SELECTION_LANGUAGE_CODE)&quot;&quot;&quot;&amp; _
			&quot; &quot;&quot;(TMP)&quot;&quot;&quot;
			s1=s1 &amp; CR &amp; &quot;&quot;&quot;(SPD_READ_TEXT_PY)&quot;&quot; &quot;&quot;(TMP)&quot;&quot;&quot;
		Endif
	Endif
	If fileExists(&quot;/usr/bin/qrencode&quot;) Then
	   	s2(0)=&quot;12&quot; 
		s2(1)=&quot;9&quot;
		s2(2)=&quot;6&quot;
		s2(3)=&quot;3&quot;
		s2(4)=&quot;1&quot;
		For n=0 to 4
			s1=s1 &amp; CR &amp; &quot;&quot;&quot;(CREATE_QR_LABEL_PY)&quot;&quot; --size &quot; &amp; s2(n) &amp; &quot; --output &quot;&quot;(HOME)(NOW).png&quot;&quot; &quot;&quot;(TMP)&quot;&quot;&quot;
			
			s1=s1 &amp; CR &amp; &quot;&quot;&quot;(CREATE_QR_LABEL_PY)&quot;&quot; --size &quot; &amp; s2(n) &amp; &quot; --output &quot;&quot;/tmp/&quot; &amp; _
			fsGetSetting(&quot;ooname&quot;) &amp; &quot; - &quot; &amp; fsStringLanguage(fiL10nADDON_READ_THE_SELECTION,fsGetLanguage()) &amp; &quot; - &quot; &amp; _
			fsUserName &amp; &quot;.png&quot;&quot; &quot;&quot;(TMP)&quot;&quot;&quot;
		Next
		s1=s1 &amp; CR &amp; &quot;&quot;&quot;(CREATE_QR_LABEL_PY)&quot;&quot; --output &quot;&quot;(HOME)(NOW).png&quot;&quot; &quot;&quot;(TMP)&quot;&quot;&quot;
		
		s1=s1 &amp; CR &amp; &quot;&quot;&quot;(CREATE_QR_LABEL_PY)&quot;&quot; --output &quot;&quot;/tmp/&quot; &amp; fsGetSetting(&quot;ooname&quot;) &amp; &quot; - &quot; &amp; fsStringLanguage(fiL10nADDON_READ_THE_SELECTION,fsGetLanguage()) &amp; &quot;.png&quot;&quot; &quot;&quot;(TMP)&quot;&quot;&quot;
	Endif
	If fileExists(&quot;/usr/bin/espeak&quot;) Then &apos; doesn&apos;t work in Windows, only Linux...
		s2(0)=&quot; -s 130 -f &apos;(TMP)&apos; -w &apos;(HOME)(NOW).wav&apos;&quot;&quot;&quot;
		s2(1)=&quot; -f &apos;(TMP)&apos; -w &apos;(HOME)(NOW).wav&apos;&quot;&quot;&quot;
		s2(2)=&quot; -s 130 -f &apos;(TMP)&apos;&quot;&quot;&quot;
		s2(3)=&quot; -f &apos;(TMP)&apos;&quot;&quot;&quot;
		s3=&quot;&quot;&quot;(OS_PY)&quot;&quot; --c &quot;&quot;espeak &quot;
	    For n=0 To 3
			&apos;English
			s1=s1 &amp; CR &amp; s3 &amp; &quot;-v en-us&quot; &amp; s2(n)
			s1=s1 &amp; CR &amp; s3 &amp; &quot;-v en&quot; &amp; s2(n)
			Select Case sLanguage
			Case &quot;es&quot;
				s1=s1 &amp; CR &amp; s3 &amp; &quot;-v es-mx&quot; &amp; s2(n)
				s1=s1 &amp; CR &amp; s3 &amp; &quot;-v es-la&quot; &amp; s2(n)
				s1=s1 &amp; CR &amp; s3 &amp; &quot;-v es&quot; &amp; s2(n)		  	
			Case &quot;fr&quot;
				s1=s1 &amp; CR &amp; s3 &amp; &quot;-v fr-be&quot; &amp; s2(n)
				s1=s1 &amp; CR &amp; s3 &amp; &quot;-v fr&quot; &amp; s2(n)
			Case &quot;nb&quot;,&quot;nn&quot;,&quot;no&quot;
				&apos; Norway
				s1=s1 &amp; CR &amp; s3 &amp; &quot;-v no&quot; &amp; s2(n)
			Case &quot;pt&quot;
				&apos; Portugal And Brazil
				s1=s1 &amp; CR &amp; s3 &amp; &quot;-v pt-pt&quot; &amp; s2(n)
				s1=s1 &amp; CR &amp; s3 &amp; &quot;-v pt&quot; &amp; s2(n)
			Case &quot;zh&quot;
				s1=s1 &amp; CR &amp; s3 &amp; &quot;-v zh-yue&quot; &amp; s2(n)
				s1=s1 &amp; CR &amp; s3 &amp; &quot;-v zh&quot; &amp; s2(n)
			Case &quot;af&quot;,&quot;bs&quot;,&quot;ca&quot;,&quot;cs&quot;,&quot;cy&quot;,&quot;da&quot;,&quot;de&quot;,&quot;el&quot;,&quot;eo&quot;,&quot;fi&quot;,&quot;hi&quot;,&quot;hr&quot;,&quot;hu&quot;,_
				&quot;hy&quot;,&quot;id&quot;,&quot;is&quot;,&quot;it&quot;,&quot;ku&quot;,&quot;la&quot;,&quot;lv&quot;,&quot;mk&quot;,&quot;nl&quot;,&quot;pl&quot;,&quot;ro&quot;,&quot;ru&quot;,&quot;sk&quot;,&quot;sq&quot;,_
				&quot;sr&quot;,&quot;sv&quot;,&quot;sw&quot;,&quot;ta&quot;,&quot;tr&quot;,&quot;vi&quot;
				s1=s1 &amp; CR &amp; s3 &amp; &quot;-v &quot; &amp; sLanguage &amp; s2(n)
			Case Else  
			End Select
			For n2=0 To fiCountEspeakMbrolaLanguage()
				s4=fsGetEspeakMbrolaLanguage(n2,1)
				If fileExists( &quot;/usr/share/mbrola/&quot; &amp; s4) or _
					fileExists( &quot;/usr/local/share/mbrola/&quot; &amp; s4) or _
					fileExists( &quot;/usr/share/mbrola/voices/&quot; &amp; s4) or _
					fileExists( &quot;/usr/local/share/mbrola/voices/&quot; &amp; s4) Then
					s1=s1 &amp; CR &amp; s3 &amp; &quot;-v mb-&quot; &amp; s4 &amp; &quot; &quot; &amp; s2(n)
				Endif
			Next
			s1=s1 &amp; CR &amp; s3 &amp; s2(n)
		Next
	EndIf
	n=0
	If fileExists( &quot;/usr/bin/text2wave&quot;)  or fileExists(fsProgramDirectoryx86() &amp; &quot;festival\text2wave&quot;) or _
 		fileExists(fsProgramDirectory() &amp; &quot;festival\texttowave&quot;) Then
		For n = 0 to fiCountFestivalDirectory
			if fileExists (fsFestivalDirectory (n)) Then
				s4=&quot;&quot;&quot;(FESTIVAL_READ_TEXT_PY)&quot;&quot;&quot; &amp; &quot; --eval &quot;&quot;(voice_&quot; &amp; fsFestivalVoice(n) &amp; &quot;)&quot;&quot;&quot;			
				s1= s1 &amp; fspyOutOptions (oDialog,s4)			
			Endif
		Next			
	Endif
	n=0
	If fileExists( &quot;/usr/bin/espeak&quot;) or fileExists(fsProgramDirectoryx86() &amp; &quot;eSpeak\command_line\espeak.exe&quot;) or _
 		fileExists(fsProgramDirectory() &amp; &quot;eSpeak\command_line\espeak.exe&quot;) Then 
		s2(0)=&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;
		s4= &quot;&quot;&quot;(ESPEAK_READ_TEXT_PY)&quot;&quot;&quot; &amp; &quot; --language=&quot;&amp; s2(n)
		s1= s1 &amp; fspyOutOptions (oDialog,s4)
	Endif
	n=6	
	If fileExists( &quot;/usr/bin/pico2wave&quot;) Then
		s2(0)=&quot;it&quot; 
		s2(1)=&quot;fr&quot;
		s2(2)=&quot;es&quot;
		s2(3)=&quot;en-GB&quot;
		s2(4)=&quot;en&quot;
		s2(5)=&quot;de&quot;
		s2(6)=&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;
		s2(7)=&quot;(SELECTION_LANGUAGE_CODE)&quot;
		s1=s1 &amp; CR &amp; &quot;&quot;&quot;(PICO_READ_TEXT_PY)&quot;&quot;&quot;&amp; &quot; --language=&quot;&amp; s2(n) &amp; &quot; --rate=80% --visible=false &quot;&quot;(TMP)&quot;&quot;&quot;	
		s4= &quot;&quot;&quot;(PICO_READ_TEXT_PY)&quot;&quot;&quot; &amp; &quot; --language=&quot;&amp; s2(n)
		s1= s1 &amp; fspyOutOptions (oDialog,s4)				
	Endif
	if asc(left(s1,1)) = 10 then
		s1 = mid(s1,2)
	end if
	a1=Split(s1,CR)
	for n = lbound(a1) + 1 to ubound(a1)
		oComboBox.addItem(a1(n),0)
	next
End Sub

function fspyOutOptions (oDialog,byval s4)
	dim s1, s2, s3, CR as string
	s1 = &quot;&quot;
	s3 =  &quot; &quot;&quot;(TMP)&quot;&quot;&quot;
	if Instr(Lcase(f_dlgSpeechSetup.GetControl(&quot;FileControl2&quot;).Model.Text),&quot;/bin/python3&quot;) = 0 Then
		s2 = s3
	else
		s2 = &quot; --title=&quot;&quot;(TITLE)&quot;&quot; &quot; &amp; s3
	endif  
	CR=Chr$(10)
	if s4 = &quot;&quot; then
		s1 = &quot;&quot;
	else
		If fbHaveFfmpeg Then
			s1=s1 &amp; CR &amp; s4 &amp; _
				&quot; --image &quot;&quot;(MY_IMAGE)&quot;&quot;&quot;&amp; _
				&quot; --output &quot;&quot;(HOME)(NOW).webm&quot;&quot;&quot;&amp; _
				s2
			s1=s1 &amp; CR &amp; s4 &amp; _
				&quot; --image &quot;&quot;(POSTER2_PNG)&quot;&quot;&quot;&amp; _
				&quot; --output &quot;&quot;(HOME)(NOW).webm&quot;&quot;&quot; &amp; _
				s2
			s1=s1 &amp; CR &amp; s4 &amp; _
				&quot; --image &quot;&quot;(POSTER_PNG)&quot;&quot;&quot;&amp; _
				&quot; --output &quot;&quot;(HOME)(NOW).webm&quot;&quot;&quot; &amp; _
				s2
		Endif
		s1=s1 &amp; CR &amp; s4 &amp; _
			&quot; --output &quot;&quot;(HOME)(NOW).wav&quot;&quot;&quot; &amp; _
			s3
		If fileExists( &quot;/usr/bin/oggenc&quot;)  Or fileExists(&quot;C:\opt\oggenc.exe&quot;)  Or fileExists(&quot;C:\opt\oggenc2.exe&quot;) Then
			s1=s1 &amp; CR &amp; s4 &amp; _
				&quot; --output &quot;&quot;(HOME)(NOW).ogg&quot;&quot;&quot; &amp; _
				s2
		Endif
		If fileExists( &quot;/usr/bin/lame&quot;)  Or fileExists(&quot;C:\opt\lame.exe&quot;) Then
			s1=s1 &amp; CR &amp; s4 &amp; _
				&quot; --output &quot;&quot;(HOME)(NOW).mp3&quot;&quot;&quot; &amp; _
				s2
		Endif
		If fileExists( &quot;/usr/bin/faac&quot;)  Or fileExists(&quot;C:\opt\neroAacEnc.exe&quot;)  Then
			s1=s1 &amp; CR &amp; s4 &amp; _
				&quot; --output &quot;&quot;(HOME)(NOW).m4a&quot;&quot;&quot; &amp; _
				s2
		Endif
		If fileExists( &quot;/usr/bin/flac&quot;) Or fileExists(&quot;C:\opt\flac.exe&quot;) Or fbHaveFfmpeg Then
			s1=s1 &amp; CR &amp; s4 &amp; _
				&quot; --output &quot;&quot;(HOME)(NOW).flac&quot;&quot;&quot; &amp; _
				s3
		Endif
		If fbHaveFfmpeg Then
			s1=s1 &amp; CR &amp; s4 &amp; _
				&quot; --output &quot;&quot;(HOME)(NOW).aif&quot;&quot;&quot; &amp; _
				s2
		Endif		
		s1=s1 &amp; CR &amp; s4 &amp; _
			s3
		s1=s1 &amp; CR &amp; s4 &amp; _
			&quot; --visible=false&quot; &amp; s3
	endif
	fspyOutOptions = s1
end function

Function AppleScriptPath() As String
	AppleScriptPath=&quot;/usr/bin/osascript&quot;
End Function

&apos;This macro deletes the temporary files that the speech program creates.
Sub resetSpeech
	Dim aFile, CR As String
	Dim a1
	Dim n as integer
	CR = Chr$(10)
	aFile=fsMyTempLock(&quot;lock&quot;) &amp; CR &amp;_
		fsMyTempLock(&quot;lock.id&quot;) &amp; CR &amp;_
		fsMyTempLock(&quot;lock.title&quot;) &amp; CR &amp;_
		fsMyTempLock(&quot;lock.album&quot;) &amp; CR &amp;_
		fsFullPathOf(fsFestivalScriptName) &amp; CR &amp; _
		fsFullPathOf(fsTemporaryTextDoc) &amp; CR &amp; _
		fsFullPathOf(fsTemporaryTtsAppleScript)
	a1 = split(sFile, CR)
	for n = lbound(a1) to ubound(a1)
		If fileExists(a1(n)) Then
			kill a1(n)
		Endif	
	next
End Sub

&apos;This macro creates a temporary script file For the Festival speech synthesiser.
Sub writeScript(myscript As String,msgs() As Variant,errorCode As Integer)
	&apos; &quot;Festival expects ISO-8859-15 encoding.&quot;
	&apos; FestCat: Speech Synthesis in Catalan using Festival
	&apos; http://festcat.talp.cat/download/archive/README 
	&apos; November, 2007. Accessed 2013-08-28
	dim aFile as string
	aFile=fsFullPathOf(fsFestivalScriptName)
	if fsComplexAsiaOrWest(myscript)=&quot;WEST&quot; Then
		fbCreateFile(aFile, myscript, &quot;iso-8859-15&quot;)
	else 
		fbCreateFile(aFile, myscript, &quot;utf-8&quot;)
	endif
End Sub

Function fsAbout() As String
	fsAbout=getTextFromFile(fsDescriptionDoc,&quot;utf-8&quot;) &apos;Application&apos;s Default encoding
End Function

Function fsVBSTextString() As String
	fsVBSTextString=getTextFromFile(fsTTSScriptVBS,&quot;iso-8859-15&quot;) &apos;iso-8859-15 Windows encoding
End Function

&apos;fsTTSListVoicesVBS

Function fsSPDTextString
	fsSPDTextString=getTextFromFile(fsPythonSpdDoc,&quot;utf-8&quot;)
End Function

Function fsPicoTextString
	fsPicoTextString=getTextFromFile(fsPythonPicoDoc,&quot;utf-8&quot;)
End Function
&apos;
Function fsEspeakTextString
	fsEspeakTextString=getTextFromFile(fsPythonEspeakDoc,&quot;utf-8&quot;)
End Function

Function fsFestivalTextString
	fsFestivalTextString=getTextFromFile(fsPythonFestivalDoc,&quot;utf-8&quot;)
End Function

Function fsPyttsxTextString
	fsPyttsxTextString=getTextFromFile(fsPythonPyttsxDoc,&quot;utf-8&quot;)
End Function

Function fsOSTextString
	fsOSTextString=getTextFromFile(fsPythonOSDoc,&quot;utf-8&quot;)
End Function

Function fsQRTextString
	fsQRTextString=getTextFromFile(fsPythonCreateQR,&quot;utf-8&quot;)
End Function

Function getTextFromFile(sFilePath,sEncoding) As String
	&apos;http://www.oooforum.org/forum/viewtopic.phtml?t=53813
	&apos;Use simpleFileAccess instead of Basic file handling To translate encoded text
	Dim myTextFile As Object,sf As Object,fileStream As Object
	Dim aLineOfText As String,myFilePath As String
	myFilePath=convertToURL(sFilePath)
	sf=createUnoService(&quot;com.sun.star.ucb.SimpleFileAccess&quot;)
	On Error Goto fichierKO
	fileStream=sf.openFileRead(myFilePath)
	myTextFile=createUnoService(&quot;com.sun.star.io.TextInputStream&quot;)
	myTextFile.InputStream=fileStream
	myTextFile.Encoding=sEncoding
	Do While Not myTextFile.IsEOF
		getTextFromFile=getTextFromFile &amp; myTextFile.readLine &amp; Chr$(13)
	Loop 
	fileStream.closeInput
	myTextFile.closeInput
	On Error Goto 0
	Exit Function
	FichierKO:
		Resume FichierKO2
	FichierKO2:
	On Error Resume Next
	Msgbox(&quot;File read Error !&quot;,16)
	fileStream.closeInput
	myTextFile.closeInput
	On Error Goto 0 
End Function

Sub writeSpeech(byval sA As String,msgs() As Variant,errorCode As Integer, optional bForceISO885915)
	&apos;creates a temporary text file For the speech synthesiser.
	&apos;UTF-8 encoding includes Asian and Complex languages.
	&apos;For western scripts, Festival expects iso-8859-15 encoding.
	if isMissing (bForceISO885915) then
		bForceISO885915 = false
	endif
	Dim bFile As String
	bFile=fsFullPathOf(fsTemporaryTextDoc)
	if (bForceISO885915) then
 		fbCreateFile(bFile, sA, &quot;iso-8859-15&quot;)
 	else
		fbCreateFile(bFile, sA, &quot;utf-8&quot;)
	endif
End Sub

function fsStripSmartQuotes(byval sA)
	sA=fsReplaceText(sA, &quot;“&quot;, &quot;&quot;&quot;&quot;)
    sA=fsReplaceText(sA, &quot;”&quot;, &quot;&quot;&quot;&quot;)
	sA=fsReplaceText(sA, &quot;‘&quot;, &quot;&apos;&quot;)
    fsStripSmartQuotes=fsReplaceText(sA, &quot;’&quot;, &quot;&apos;&quot;)   
end function

Sub ttsActuate(config() As Variant,msgs() As Variant,errorCode As Integer,sOverRide As String)
	Dim sCommand As String
	Dim sScript As String
	Dim sTextToSpeak As String
	Dim sProgram As String
	Dim aVal As Integer
	Dim bWait As Boolean
	Dim oBar    &apos; Generated status bar 
	Dim oFrame  &apos; Current frame
	On Error Goto errorHandler
	&apos;Choose what To speak
	If sOverRide=&quot;&quot; Then  
		sTextToSpeak=fsGetTextSelection()
	Else
		sTextToSpeak=sOverRide
	Endif
	If fileexists(fsMyTempLock(&quot;lock.id&quot;)) Then
		Kill fsMyTempLock(&quot;lock.id&quot;)
	Endif
	If fileexists(fsMyTempLock(&quot;lock.title&quot;)) Then
		Kill fsMyTempLock(&quot;lock.title&quot;)
	Endif
	If fileexists(fsMyTempLock(&quot;lock.album&quot;)) Then
		Kill fsMyTempLock(&quot;lock.album&quot;)
	Endif
	If Len(sTextToSpeak) = 0 then
		Exit sub
	Endif
	On Error Resume Next
	oFrame=ThisComponent.getCurrentController().getFrame() 
	oBar=oFrame.createStatusIndicator() 
	oBar.start(fsStringLanguage( fiL10nADDON_READ_THE_SELECTION,fsGetLanguage()),100)
	On Error Goto ErrorHandler
	sCommand=&quot;&quot;
	sScript=&quot;&quot;
	&apos;Get rid of the old files containing a script And/or plain text of selected String
	resetSpeech
	&apos; An external osa script, python script, or vbs script writes fsMyTempLock(&quot;lock&quot;),
	&apos; does the work, then removes the file when it completes the work.
	&apos; Default avconv, iTunes or ffmpeg (Miro) media metadata:
	&apos;    [Miro](http://ftp.osuosl.org/pub/pculture.org/mirovideoconverter/)
	CreateFile(fsMyTempLock(&quot;lock.id&quot;), fsThisDocAuthor(), &quot;UTF-8&quot;)
	CreateFile(fsMyTempLock(&quot;lock.title&quot;), fsThisDocTitle(), &quot;UTF-8&quot;)
	CreateFile(fsMyTempLock(&quot;lock.album&quot;), &quot;(&quot; &amp; fsStringLanguage(fiL10nADDON_READ_THE_SELECTION,fsGetLanguage()) &amp; &quot;)&quot;, &quot;UTF-8&quot;)
	On Error Resume Next
	oBar.Value=30
	On Error Goto errorHandler
	If fsGetOS() = &quot;OSX&quot; Then
		&apos; Make sure the sound is at least 400 milliseconds long.
		sTextToSpeak = sTextToSpeak &amp; &quot;[[slnc 400]]&quot;
	Endif
	If config(fiFestivalOption) Then
		&apos;Write the Festival script and the file to read aloud
		sProgram=config(fiFestivalPath)
		sCommand=&quot;&quot;&quot;&quot; &amp; ConvertFromURL(fsFullPathOf(fsFestivalScriptName)) &amp; &quot;&quot;&quot;&quot;	
		&apos; Windows - Don&apos;t limit to SAPI languages
		sScript=config(fiFestivalComboChoice)
		sScript=replaceLocalTokensWithStr(sScript)
		sScript=replacePublicTokensWithStr(sScript)
		if fsComplexAsiaOrWest(sTextToSpeak)=&quot;WEST&quot; then
			&apos; Compatible characters are officially supported by Festival using iso-8859-15
			writeScript(sScript,msgs(),errorCode, true)
			writeSpeech(sTextToSpeak,msgs(),errorCode, true)
		else
			&apos; use utf-8 - Complex and Asian characters may not be supported by your version of Festival
			writeScript(sScript,msgs(),errorCode, false)
			writeSpeech(sTextToSpeak,msgs(),errorCode, false)
		endif
	Elseif config(fiExternalOption) Then
		sProgram=config(fiExternalProgramPath)
		sCommand=config(fiExternalCommand)
		if Instr(Lcase(f_dlgSpeechSetup.GetControl(&quot;FileControl2&quot;).Model.Text),&quot;bin/padsp&quot;) &gt; 0 then
			if Instr(Lcase(f_dlgSpeechSetup.GetControl(&quot;ComboBox2&quot;).Model.Text),&quot;swift&quot;) &gt; 0 then
				&apos;Cepstral swift Alison (2008) for Linux does not pronounce text around smart quotes correctly,
				&apos;so we strip the smart quotes. Be sure to tell swift to use utf-8 encoded text as follows: 
				&apos;&quot;Read with external program&quot; set to /usr/bin/padsp and &quot;Command line options&quot; to swift -e utf-8 -m text -f &quot;(TMP)&quot;
				sTextToSpeak=fsStripSmartQuotes(sTextToSpeak)
			endif
		endif
		writeSpeech(sTextToSpeak,msgs(),errorCode, false)
		if (fsGetOS()=&quot;OSX&quot; Or fsGetOS()=&quot;MAC&quot;) and Instr(Lcase(f_dlgSpeechSetup.GetControl(&quot;FileControl2&quot;).Model.Text),&quot;bin/osascript&quot;) &gt; 0 then
			if instr(sCommand,&quot;&quot;&quot;(SAY_APPLESCRIPT_SLOWLY)&quot;&quot;&quot;)=1 then
				fswriteOSXSpeechScript (&quot;-r 110 &quot;, fsSelectionLanguageAndRegion(true))
			elseif instr(sCommand,&quot;&quot;&quot;(SAY_APPLESCRIPT_QUICKLY)&quot;&quot;&quot;)=1 then
				fswriteOSXSpeechScript (&quot;-r 240 &quot;, fsSelectionLanguageAndRegion(true))
			elseif instr(sCommand,&quot;&quot;&quot;(SAY_APPLESCRIPT_AIRPLAY)&quot;&quot;&quot;)=1 then
				fswriteOSXSpeechScript (&quot;-a AirPlay &quot;, fsSelectionLanguageAndRegion(true))
			elseif instr(sCommand,&quot;&quot;&quot;(SAY_APPLESCRIPT_AIRPLAY_SLOWLY)&quot;&quot;&quot;)=1 then
				fswriteOSXSpeechScript (&quot;-a AirPlay -r 110 &quot;, fsSelectionLanguageAndRegion(true))
			elseif instr(sCommand,&quot;&quot;&quot;(SAY_APPLESCRIPT_AIRPLAY_QUICKLY)&quot;&quot;&quot;)=1 then
				fswriteOSXSpeechScript (&quot;-a AirPlay -r 240 &quot;, fsSelectionLanguageAndRegion(true))
			elseif  Instr(config(fiExternalCommand),&quot;(SAY_APPLESCRIPT_SYSTEM_VOICE)&quot;) Then
				fswriteOSXSpeechScript (&quot;&quot;, &quot;&quot;)
			else
				fswriteOSXSpeechScript (&quot;&quot;, fsSelectionLanguageAndRegion(true))
			endif
		endif
		if instr(sCommand,&quot;&quot;&quot;(TTS_WSCRIPT_VBS)&quot;&quot;&quot;)=1 then
			&apos;only consider SAPI voices
			
			sCommand= fsReplaceText(sCommand,&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;,fsSelectionLanguageAndRegion(false))
		endif
		sCommand=replaceLocalTokensWithStr(sCommand)
		sCommand=replacePublicTokensWithStr(sCommand)
		sCommand=replaceWebTokensWithStr(sCommand,sTextToSpeak) &apos;for online content with media player
	Else &apos;If config(fiHtmlOption) Then
	&apos;Translate And read with web tools
		sProgram=&quot;com.sun.star.system.SystemShellExecute&quot;
		sCommand=config(fiHtmlComboURL)
		sCommand=replacePublicTokensWithStr(sCommand)
		sCommand=replaceWebTokensWithStr(sCommand,sTextToSpeak)
		&apos; HTML file
		if Len(sCommand) &lt;&gt; 0 Then
			If (Instr(sCommand,&quot;http://&quot;)&lt;&gt;1 And Instr(sCommand,&quot;https://&quot;)&lt;&gt;1 And Instr(sCommand,&quot;mailto:&quot;)&lt;&gt;1) Then
				sCommand=&quot;http://&quot; &amp; sCommand
			Endif
			Dim oSvc As Object
			oSvc=createUnoService(sProgram)
			oSvc.execute(sCommand,&quot;&quot;,0)
		Else
			ErrorDisplay()
		Endif
	oBar.End()
		Exit Sub
	Endif
	
	If fileExists(sProgram) Then
		&apos; program path
		&apos; 0 - focus is On the hidden program window,
		&apos; program parameter strings,
		&apos; False - tasks do Not wait until shell task ends
		bWait=False
	If sCommand &lt;&gt; &quot;&quot; Then 
		errorCode=Shell(sProgram,0,sCommand,bWait)
		Endif
		On Error Resume Next
		oBar.Value=60
		On Error Goto errorHandler
	Else
		Msgbox( fsStringLanguage( fiL10nCOULD_NOT_LOCATE_THE_PROGRAM,fsGetLanguage()) &amp; _
			fsStringLanguage( fiL10nSTRING_CANNOT_BE_ANALYZED,fsGetLanguage()),64,_
			fsStringLanguage( fiL10nADDON_READ_THE_SELECTION,fsGetLanguage()))
		If fileExists(	fsFullPathOf(fsExtensionSettingsIni)) Then
			kill fsFullPathOf(fsExtensionSettingsIni)
		Endif
		resetSpeech
	Endif
	On Error Resume Next
	oBar.Value=100
	oBar.End() 
	Exit Sub
	ErrorHandler:
		Msgbox(fsStringLanguage( fiL10nSTRING_CANNOT_BE_ANALYZED,fsGetLanguage()),48,_
			fsStringLanguage( fiL10nADDON_READ_THE_SELECTION,fsGetLanguage()))
		If fileExists(fsFullPathOf(fsExtensionSettingsIni)) Then
			kill fsFullPathOf(fsExtensionSettingsIni)	
		Endif
		resetSpeech
End Sub

function fsReplaceText(sA as string, sFind as string, sReplace as string) as string
	if not GlobalScope.BasicLibraries.isLibraryLoaded(&quot;Tools&quot;) then 
		GlobalScope.BasicLibraries.loadLibrary(&quot;Tools&quot;)
	endif
	fsReplaceText = ReplaceString(sA, sReplace, sFind)
end function

Function replaceLocalTokensWithStr(sA As String) As String
	&apos;This Function takes a String with tokens And replaces each token with
	&apos;a useful String 
		Dim sFind As String
		Dim sReplace As String
		Dim sB As String
		sB=fsGetTextSelection()
		&apos;Temporary file name
		sFind=&quot;(TMP)&quot;
		sReplace=ConvertFromURL(fsFullPathOf(fsTemporaryTextDoc))
		sA=fsReplaceText(sA,sFind,sReplace)
	
		sFind=&quot;(TTS_WSCRIPT_VBS)&quot;
		sReplace=ConvertFromURL(fsTTSScriptVBS)
		sA=fsReplaceText(sA,sFind,sReplace)
		
		sFind=&quot;(SPD_READ_TEXT_PY)&quot;
		sReplace=ConvertFromURL(fsPythonSpdDoc)
		sA=fsReplaceText(sA,sFind,sReplace)

		sFind=&quot;(PICO_READ_TEXT_PY)&quot;
		sReplace=ConvertFromURL(fsPythonPicoDoc)
		sA=fsReplaceText(sA,sFind,sReplace)

		sFind=&quot;(ESPEAK_READ_TEXT_PY)&quot;
		sReplace=ConvertFromURL(fsPythonEspeakDoc)
		sA=fsReplaceText(sA,sFind,sReplace)

		sFind=&quot;(FESTIVAL_READ_TEXT_PY)&quot;
		sReplace=ConvertFromURL(fsPythonFestivalDoc)
		sA=fsReplaceText(sA,sFind,sReplace)
		
		sFind=&quot;(PYTTSX_READ_TEXT_PY)&quot;
		sReplace=ConvertFromURL(fsPythonPyttsxDoc)
		sA=fsReplaceText(sA,sFind,sReplace)
		
		sFind=&quot;(OS_PY)&quot;
		sReplace=ConvertFromURL(fsPythonOSDoc)
		sA=fsReplaceText(sA,sFind,sReplace)

		sFind=&quot;(SAY_APPLESCRIPT)&quot;
		sReplace=ConvertFromURL(fsTemporaryTtsAppleScript)
		sA=fsReplaceText(sA,sFind,sReplace)
		
		sFind=&quot;(SAY_APPLESCRIPT_SLOWLY)&quot;
		sReplace=ConvertFromURL(fsTemporaryTtsAppleScript)
		sA=fsReplaceText(sA,sFind,sReplace)	

		sFind=&quot;(SAY_APPLESCRIPT_QUICKLY)&quot;
		sReplace=ConvertFromURL(fsTemporaryTtsAppleScript)
		sA=fsReplaceText(sA,sFind,sReplace)
		
		sFind=&quot;(SAY_APPLESCRIPT_AIRPLAY)&quot;
		sReplace=ConvertFromURL(fsTemporaryTtsAppleScript)
		sA=fsReplaceText(sA,sFind,sReplace)

		sFind=&quot;(SAY_APPLESCRIPT_AIRPLAY_SLOWLY)&quot;
		sReplace=ConvertFromURL(fsTemporaryTtsAppleScript)
		sA=fsReplaceText(sA,sFind,sReplace)	

		sFind=&quot;(SAY_APPLESCRIPT_AIRPLAY_QUICKLY)&quot;
		sReplace=ConvertFromURL(fsTemporaryTtsAppleScript)
		sA=fsReplaceText(sA,sFind,sReplace)
		
		sFind=&quot;(SAY_APPLESCRIPT_SYSTEM_VOICE)&quot;
		sReplace=ConvertFromURL(fsTemporaryTtsAppleScript)
		sA=fsReplaceText(sA,sFind,sReplace)		
		
		sFind=&quot;(CREATE_QR_LABEL_PY)&quot;
		sReplace=ConvertFromURL(fsPythonCreateQR)
		sA=fsReplaceText(sA,sFind,sReplace)
	
		&apos;Work directory also known As My Documents or home
		sFind=&quot;(HOME)&quot;
		sReplace=ConvertFromURL(fsPathSettings(&quot;Work&quot;) &amp; &quot;/&quot;)
		if not (fileExists(sReplace)) then
			&apos; let&apos;s try to make the directory
			&apos; if we fail, then we look in other spots.
			if fbCreateFile(sReplace &amp; &quot;log.txt&quot;, fsGetSetting(&quot;ooname&quot;) &amp; &quot; - &quot; &amp; fsFileTime() &amp; &quot; - created HOME directory &quot;, &quot;utf-8&quot;) then
				kill sReplace &amp; &quot;log.txt&quot;
			else
				if Instr(Environ(&quot;pwd&quot;)) &lt;&gt; &quot;&quot; then
					&apos;&quot;OSX&quot;,&quot;MAC&quot; or &quot;UNIX&quot; 
					sReplace = Environ(&quot;pwd&quot;) &amp; &quot;/&quot;
				elseif Instr(Environ(&quot;HOMEPATH&quot;)) &lt;&gt; &quot;&quot; then
					&apos; &quot;WINDOWS&quot;
					sReplace = Environ(&quot;HOMEPATH&quot;) &amp; &quot;\&quot;
				elseif Instr(Environ(&quot;HOME&quot;)) &lt;&gt; &quot;&quot; then
					&apos; legacy posix
					sReplace = Environ(&quot;HOME&quot;) &amp; &quot;/&quot;
				else
					&apos; root of home drive
					sReplace = ConvertFromURL(&quot;file:///&quot;)
				endif 
			endif
		endif
		sA=fsReplaceText(sA,sFind,sReplace)
		&apos;Current time reformatted so that you can use it in a filename
		sFind=&quot;(NOW)&quot;
		sReplace=fsFileTime()
		sA=fsReplaceText(sA,sFind,sReplace)
	
		sFind=&quot;(SOUND_GALLERY)&quot;
		sReplace=soundsDirectory()
		sA=fsReplaceText(sA,sFind,sReplace)
		
		&apos;Sample image for movie clip with embedded speech
		sFind=&quot;(POSTER_PNG)&quot;
		sReplace=ConvertFromURL(fsPosterPng)
		sA=fsReplaceText(sA,sFind,sReplace)
		
		&apos;Sample image for movie clip with embedded speech
		sFind=&quot;(POSTER2_PNG)&quot;
		sReplace=ConvertFromURL(fsPoster2Png)
		sA=fsReplaceText(sA,sFind,sReplace)

		&apos;Choose an image for your movie clip with embedded speech
		if instr(sA,&quot;(MY_IMAGE)&quot;)&gt;0 Then
			sFind=&quot;(MY_IMAGE)&quot;
			sReplace=fsGetPicturePath()
			sA=fsReplaceText(sA,sFind,sReplace)
		Endif	
		&apos;New line 
		sFind=&quot;(/NL)&quot;
		sReplace=Chr$(13)
		sA=fsReplaceText(sA,sFind,sReplace)
		&apos;	
		replaceLocalTokensWithStr=sA
End Function

Function ReplaceWebTokensWithStr(sA As String,sB As String) As String
	Dim sFind As String
	Dim sReplace As String
	
	sFind=&quot;(OOO_WEBTEXTBIG)&quot;
	sReplace=fsEscapeStr(Left(sB,9999)) &apos; A lot of text. Use If you have a dedicated online speech server.
	sA=fsReplaceText(sA,sFind,sReplace)
	
	sFind=&quot;(OOO_WEBTEXT)&quot;
	sReplace=fsEscapeStr(Left(sB,999)) &apos; Use with free online text-To-speech utilities
	sA=fsReplaceText(sA,sFind,sReplace)
	
	sFind=&quot;(OOO_WEBTEXT250)&quot;
	sReplace=fsEscapeStr(Left(sB,249)) &apos; Use with online QRCode utilities
	sA=fsReplaceText(sA,sFind,sReplace)
	
	sFind=&quot;(OOO_WEBTEXTSMALL)&quot; &apos; Use with Google Translate To ensure that the text-To-speech is enabled
	sReplace=fsEscapeStr(Left(sB,99))
	sA=fsReplaceText(sA,sFind,sReplace)
	ReplaceWebTokensWithStr=sA
End Function

Function replacePublicTokensWithStr(sA As String) As String
	Dim sFind As String
	Dim sReplace As String
	
	sFind=&quot;(AUTHOR)&quot;
	sReplace=fsReplaceText(fsThisDocAuthor,&quot; &quot;,chr$(160)) &apos;&amp;nbsp;
	sA=fsReplaceText(sA,sFind,sReplace)
	
	sFind=&quot;(TITLE)&quot;
	sReplace=fsReplaceText(fsThisDocTitle,&quot; &quot;,chr$(160)) &apos;&amp;nbsp;
	If sReplace=&quot;&quot; Then 
		sReplace=fsDateMyRegion() &amp; &quot;_&quot; &amp; fsTimeMyRegion()
	Endif
	sA=fsReplaceText(sA,sFind,sReplace)
		
	&apos;Current date
	sFind=&quot;(DATE)&quot;
	sReplace=fsReplaceText(fsDateMyRegion,&quot; &quot;,chr$(160)) &apos;&amp;nbsp;
	sA=fsReplaceText(sA,sFind,sReplace)
	
	&apos;Current time As spoken in region
	sFind=&quot;(TIME)&quot;
	sReplace=fsTimeMyRegion()
	sA=fsReplaceText(sA,sFind,sReplace)
	
	&apos;Current day of week As spoken in region
	sFind=&quot;(WEEKDAY)&quot;
	sReplace=fsWeekDayMyRegion()
	sA=fsReplaceText(sA,sFind,sReplace)
	
	&apos;Language - en For English fr For French etc. ISO_639-1
	sFind=&quot;(LANGUAGE_CODE)&quot;
	sReplace=fsGetLanguage()
	sA=fsReplaceText(sA,sFind,sReplace)
	
	&apos;Country - US For United States FR For France etc.
	sFind=&quot;(COUNTRY_CODE)&quot;
	sReplace=fsGetCountry()
	sA=fsReplaceText(sA,sFind,sReplace)
	
	&apos;Language And Region en-US or fr-FR
	sFind=&quot;(LANGUAGE_COUNTRY_CODE)&quot;
	sReplace=fsGetLanguage()&amp; &quot;-&quot; &amp; fsGetCountry()
	sA=fsReplaceText(sA,sFind,sReplace)
	
	&apos;Selection Country - US For United States FR For France etc. 
	sFind=&quot;(SELECTION_COUNTRY_CODE)&quot;
	sReplace=fsSelectionCountry()
	sA=fsReplaceText(sA,sFind,sReplace)
	
	&apos;Selection Language - en For English fr For French etc. ISO_639-1
	sFind=&quot;(SELECTION_LANGUAGE_CODE)&quot;
	sReplace=fsSelectionLanguage()
	sA=fsReplaceText(sA,sFind,sReplace)
	
	&apos;Selection Language And Region en-US or fr-FR
	sFind=&quot;(SELECTION_LANGUAGE_COUNTRY_CODE)&quot;
	sReplace=fsSelectionLanguageAndRegion(true)
	sA=fsReplaceText(sA,sFind,sReplace)
	replacePublicTokensWithStr=sA
End Function


Function fsFileTime() As String
	&apos;Revised 2011-02-20_17-18 so all versions and locales return the same value
	fsFileTime=Year(NOW) &amp; &quot;-&quot; &amp; Month(NOW) &amp; &quot;-&quot; &amp; Day(NOW) &amp; &quot;_&quot; &amp; fsReplaceText(Time(NOW),&quot;:&quot;,&quot;-&quot;)
End Function

Function fsPathSettings(sPathType As String,Optional bshowall As Boolean,Optional ListIndex As Integer) As String
	&apos; Gets a special configured PathSetting
	Dim oSettings,oPathSettings As Object
	Dim sPath As String
	Dim PathList() As String
	Dim MaxIndex As Integer
	Dim oPS As Object
	oPS=createUnoService(&quot;com.sun.star.util.PathSettings&quot;)

  	If Not IsMissing(bShowall) Then
		If bShowAll Then
			ShowPropertyValues(oPS)
			Exit Function
		Endif
	Endif
 	sPath=oPS.getPropertyValue(sPathType)
	If Not IsMissing(ListIndex) Then
		&apos; Share And User-Directory
		If Instr(1,sPath,&quot;;&quot;) &lt;&gt; 0 Then
			PathList=ArrayoutofString(sPath,&quot;;&quot;,MaxIndex)
			If ListIndex &lt;=MaxIndex Then
				sPath=PathList(ListIndex)
			Else
				Msgbox( fsStringLanguage( fiL10nSTRING_CANNOT_BE_ANALYZED,fsGetLanguage()),48,_
					fsStringLanguage( fiL10nADDON_READ_THE_SELECTION,fsGetLanguage()))
			Endif
		Endif
	Endif
	If Instr(1,sPath,&quot;;&quot;)=0 Then
		fsPathSettings=ConvertToUrl(sPath)
	Else
		fsPathSettings=sPath
	Endif
End Function

Function fiStringToInteger(value As String) As Integer 
	Dim b As Integer: b=0
	Dim v As String: v=Trim(value)
	On Error Goto CONVERSIONERROR
	b=value
	fiStringToInteger=b
	Exit Function
	CONVERSIONERROR:
	fiStringToInteger=0
End Function 

Function fsgetCursorWord As String
	&apos; Function To get a word under the current cursor position.
	&apos; Adapted from code contributed On 2009-04-25  by JohnV To 
	&apos; http://www.oooforum.org/forum/viewtopic.phtml?t=83411&amp;highlight=
	Dim oDoc,oVC,oTC
	oDoc=ThisComponent
	oVC=oDoc.getCurrentController.getViewCursor
	oTC=oDoc.getText.createTextCursorByRange(oVC,False)
	oTC.gotoEndOfWord(False)
	oTC.gotoStartOfWord(True)
	fsgetCursorWord=oTC.String
End Function

Function fsSelectionLanguageAndRegion(optional bIgnoreInstalledVoices) As String
	dim sA,sB as string
	if isMissing (bIgnoreInstalledVoices) then 
		bIgnoreInstalledVoices = true
	endif
	sA = fsSelectionLanguage &amp; &quot;-&quot; &amp; fsSelectionCountry
	sB = fsSelectionLanguage
	if bIgnoreInstalledVoices then
		fsSelectionLanguageAndRegion=sA
	else
		select case fsGetOS()
		case &quot;WINDOWS&quot;
			if fbWindowsHasVoiceInThisLanguage (sA) then
			&apos; use language and locale
				fsSelectionLanguageAndRegion=sA		
			elseif fbWindowsHasVoiceInThisLanguage(sB) then
			&apos; use language only
				fsSelectionLanguageAndRegion=sB
			else
			&apos; try using the language only...
				fsSelectionLanguageAndRegion=sB
			endif
		case else
			fsSelectionLanguageAndRegion=sA
		end select
	endif
End Function

function fbWindowsHasVoiceInThisLanguage (Optional byval sLang)
	&apos; Since Windows Vista, we can use Speech XML
	&apos; http://www.w3.org/TR/speech-synthesis
	&apos; Determine which SAPI voices are installed, then
	&apos; if we have a modern voice from Windows Vista, Windows 7 or above
	&apos; then return true, else  if no voices found, then return false
	dim Sapi as object
	dim n,n1 as integer
	dim s1, s2 as string
	if ismissing(sLang) then
		sLang = fsGetSetting(&quot;language&quot;)
	endif
	sLang = lcase (sLang)
	fbWindowsHasVoiceInThisLanguage = false
	&apos;on Error goto VoiceTestError
	Set Sapi=Createobject(&quot;Sapi.SpVoice&quot;)
	s1 =lcase (isoToEnglish(sLang))
	&apos;Let&apos;s see if we recognize the language s1
	for n = 0 to Sapi.GetVoices.Count - 1
		s2=lcase(Sapi.GetVoices.Item(n).GetDescription)
		if instr(s2,s1) &lt;&gt; 0 then
			fbWindowsHasVoiceInThisLanguage = true
			exit for
		endif
	next
	Set Sapi = Nothing
	exit function
	VoiceTestError:
	fbWindowsHasVoiceInThisLanguage = false
	on Error resume next
end function

function isoToEnglish (s1)
	&apos; Returns name of language, if known			
	dim S2 as string
	select case lcase (S1)
	case &quot;en-us&quot;
		S2=&quot;English (United States)&quot;
	case &quot;en-gb&quot;
		S2= &quot;English (Great Britain)&quot;
	case &quot;en-vg&quot;
		S2= &quot;English (British Virgin Islands)&quot;
	case &quot;en-io&quot;
		S2= &quot;English (Great Britain)&quot;
	case &quot;en-gg&quot;
		S2=&quot;English (Guernsey)&quot;
	case &quot;en-au&quot;
		S2=&quot;English (Australia)&quot;
	case &quot;en-bz&quot;
		S2=&quot;English (Belize)&quot;
	case &quot;en-ca&quot;
		S2=&quot;English (Canada)&quot;
	case &quot;en-bs&quot;
		S2=&quot;English (Bahamas)&quot;
	case &quot;en-hk&quot;
		S2=&quot;English (Hong Kong)&quot;
	case &quot;en-in&quot;
		S2=&quot;English (India)&quot;
	case &quot;en-id&quot;
		S2=&quot;English (Indonesia)&quot;
	case &quot;en-ie&quot;
		S2=&quot;English (Ireland)&quot;
	case &quot;en-jm&quot;
		S2=&quot;English (Jamaica)&quot;
	case &quot;en-my&quot;
		S2=&quot;English (Malaysia)&quot;
	case &quot;en-nz&quot;
		S2=&quot;English (New Zealand)&quot;
	case &quot;en-ph&quot;
		S2=&quot;English (Philippines)&quot;
	case &quot;en-sg&quot;
		S2=&quot;English (Singapore)&quot;
	case &quot;en-za&quot;
		S2=&quot;English (South Africa)&quot;
	case &quot;en-tt&quot;
		S2=&quot;English (Trinidad &quot; &apos;sic
	case &quot;en-zw&quot;
		S2=&quot;English (Zimbabwe)&quot;
	case &quot;en&quot;
		S2=&quot;English&quot;
	case &quot;fr-be&quot;
		S2=&quot;French (Belgium)&quot;
	case &quot;fr-ca&quot;
		S2=&quot;French (Canada)&quot;
	case &quot;fr-cg&quot;
		S2=&quot;French (Congo)&quot;
	case &quot;fr-ch&quot;
		S2=&quot;French (Switzerland)&quot;
	case &quot;fr-ci&quot;
		S2=&quot;French (Ivory Coast)&quot;
	case &quot;fr-cm&quot;
		S2=&quot;French (Cameroon)&quot; 
	case &quot;fr-fr&quot;
		S2=&quot;French (France)&quot;
	case &quot;fr-ht&quot;
		S2=&quot;French (Haiti)&quot;
	case &quot;fr-lu&quot;
		S2=&quot;French (Luxembourg)&quot;
	case &quot;fr-ma&quot;
		S2=&quot;French (Morocco)&quot;
	case &quot;fr-mc&quot;
		S2=&quot;French (Monaco)&quot;
	case &quot;fr-ml&quot;
		S2=&quot;French (Mali)&quot;
	case &quot;fr-re&quot;
		S2=&quot;French (Reunion)&quot;
	case &quot;fr-sn&quot;
		S2=&quot;French (Senegal)&quot;
	case &quot;fr&quot;
		S2=&quot;French&quot;
	case &quot;it&quot;,&quot;it-it&quot;
		S2=&quot;Italian&quot;
	case &quot;de-at&quot;
		S2=&quot;German (Austria)&quot;
	case &quot;de-ch&quot;
		S2=&quot;German (Switzerland)&quot;
	case &quot;de-de&quot;
		S2=&quot;German (Germany)&quot;
	case &quot;de-li&quot;
		S2=&quot;German (Lithuania)&quot;
	case &quot;de-lu&quot;
		S2=&quot;German (Luxembourg)&quot;
	case &quot;de&quot;
		S2=&quot;German&quot;
	case &quot;es-es&quot;
		S2=&quot;Spanish (Spain)&quot;
	case &quot;es-ar&quot;
		S2=&quot;Spanish (Argentina)&quot;
	case &quot;es-bo&quot;
		S2=&quot;Spanish (Bolivia)&quot;
	case &quot;es-cl&quot;
		S2=&quot;Spanish (Chile)&quot;
	case &quot;es-co&quot;
		S2=&quot;Spanish (Colombia)&quot;
	case &quot;es-cr&quot;
		S2=&quot;Spanish (Costa Rica)&quot;
	case &quot;es-do&quot;
		S2=&quot;Spanish (Dominican Republic)&quot;
	case &quot;es-ec&quot;
		S2=&quot;Spanish (Ecuador)&quot;
	case &quot;es-sv&quot;
		S2=&quot;Spanish (Svalbard) &quot;
	case &quot;es-gt&quot;
		S2=&quot;Spanish (Guatemala)&quot;
	case &quot;es-hn&quot;
		S2=&quot;Spanish (Honduras)&quot;
	case &quot;es-mx&quot;
		S2=&quot;Spanish (Mexico)&quot;
	case &quot;es-ni&quot;
		S2=&quot;Spanish (Nicaragua)&quot;
	case &quot;es-pa&quot;
		S2=&quot;Spanish (Panama)&quot;
	case &quot;es-py&quot;
		S2=&quot;Spanish (Paraguay)&quot;
	case &quot;es-pe&quot;
		S2=&quot;Spanish (Peru)&quot;
	case &quot;es-pr&quot;
		S2=&quot;Spanish (Puerto Rico)&quot;
	case &quot;es-us&quot;
		S2=&quot;Spanish (United States)&quot;
	case &quot;es-uy&quot;
		S2=&quot;Spanish (Uraguay)&quot;
	case &quot;es-ve&quot;
		S2=&quot;Spanish (Venezuela)&quot;
	case &quot;es&quot;
		S2=&quot;Spanish&quot;
	case &quot;ru&quot;,&quot;ru-ru&quot;
		S2=&quot;Russian&quot;
	case &quot;hi&quot;,&quot;hi-in&quot;
		S2=&quot;Hindi&quot;
	case &quot;af&quot;,&quot;af-za&quot;
		S2=&quot;Afrikaans&quot;
	case &quot;ak&quot;,&quot;ak-gh&quot;
		S2=&quot;Akan&quot;
	case &quot;an&quot;,&quot;an-es&quot;
		S2=&quot;Argonese&quot;
	case &quot;az&quot;,&quot;az-az&quot;
		S2=&quot;Azerbaijani&quot;
	case &quot;ar-sa&quot;
		S2=&quot;Arabic (Saudi Arabia)&quot;
	case &quot;ar-dz&quot;
		S2=&quot;Arabic (Algeria)&quot;
	case &quot;ar-bh&quot;
		S2=&quot;Arabic (Bhutan)&quot;
	case &quot;ar-eg&quot;
		S2=&quot;Arabic (Egypt)&quot;
	case &quot;ar-iq&quot;
		S2=&quot;Arabic (Iraq)&quot;
	case &quot;ar-jo&quot;
		S2=&quot;Arabic (Jordan)&quot;
	case &quot;ar-kw&quot;
		S2=&quot;Arabic (Kuwait)&quot;
	case &quot;ar-lb&quot;
		S2=&quot;Arabic (Lebanon)&quot;
	case &quot;ar-ly&quot;
		S2=&quot;Arabic (Libya)&quot;
	case &quot;ar-om&quot;
		S2=&quot;Arabic (Oman)&quot;
	case &quot;ar-qa&quot;
		S2=&quot;Arabic (Qatar)&quot;
	case &quot;ar-sy&quot;
		S2=&quot;Arabic (Syria)&quot;
	case &quot;ar-tn&quot;
		S2=&quot;Arabic (Tunisia)&quot;
	case &quot;ar-ae&quot;
		S2=&quot;Arabic (United Arab Emirates)&quot;
	case &quot;ar-ye&quot;
		S2=&quot;Arabic (Yemen)&quot;
	case &quot;ar&quot;
		S2=&quot;Arabic&quot;
	case &quot;be&quot;,&quot;be-by&quot;
		S2=&quot;Belarusian&quot;
	case &quot;bm&quot;,&quot;bm-ml&quot;
		S2=&quot;Bambara&quot;
	case &quot;beq&quot;,&quot;beq-cg&quot;
		S2=&quot;Beembe&quot;
	case &quot;bk&quot;,&quot;bkw-cg&quot;
		S2=&quot;Bekwel&quot;
	case &quot;bn&quot;,&quot;bn-bd&quot;
		S2=&quot;Bengali&quot;
	case &quot;bs&quot;,&quot;bs-bn&quot;
		S2=&quot;Bosnian&quot;
	case &quot;buc&quot;,&quot;buc-yt&quot;
		S2=&quot;Bushi&quot;
	case &quot;eu&quot;,&quot;eu-fr&quot;,&quot;eu-es&quot;
		S2=&quot;Basque&quot;
	case &quot;bg&quot;,&quot;bg-bg&quot;
		S2=&quot;Bulgarian&quot;
	case &quot;ca&quot;,&quot;ca-es&quot;
		S2=&quot;Catalan&quot;
	case &quot;ceb&quot;,&quot;ceb-ph&quot;
		S2=&quot;Cebuano&quot;
	case &quot;cop&quot;,&quot;cop-eg&quot;
		S2=&quot;Coptic&quot;
	case &quot;csb&quot;,&quot;csb-pl&quot;
		S2=&quot;Kashubian&quot;
	case &quot;cv&quot;,&quot;cv-ru&quot;
		S2=&quot;Chuvash&quot;
	case &quot;cs&quot;,&quot;cs-cz&quot;
		S2=&quot;Czech&quot;
	case &quot;cy&quot;,&quot;cy-gb&quot;
		S2=&quot;Welsh&quot;
	case &quot;da&quot;,&quot;da-dk&quot;
		S2=&quot;Danish&quot;
	case &quot;dsb&quot;,&quot;dsb-de&quot;
		S2=&quot;Sorbian, Lower&quot;
	case &quot;ebo&quot;,&quot;ebo-cg&quot;
		S2=&quot;Teke-Eboo&quot;
	case &quot;ee&quot;,&quot;ee-gh&quot;
		S2=&quot;Éwé&quot;		
	case &quot;eo&quot;,&quot;eo-&quot;
		S2=&quot;Esperanto&quot;
	case &quot;et&quot;,&quot;et-ee&quot;
		S2=&quot;Estonian&quot;
	case &quot;fa&quot;,&quot;fa-ir&quot;
		S2=&quot;Farsi&quot;		
	case &quot;fi&quot;,&quot;fi-fi&quot;
		S2=&quot;Finnish&quot;
	case &quot;fj&quot;,&quot;fj-fj&quot;
		S2=&quot;Fijian&quot;
	case &quot;fu&quot;,&quot;fu-it&quot;
		S2=&quot;Friulian&quot;
	case &quot;fy&quot;,&quot;fy-nl&quot;
		S2=&quot;Frisian&quot;
	case &quot;gd&quot;,&quot;gd-gb&quot;
		S2=&quot;Gaelic&quot;
	case &quot;gl&quot;,&quot;gl-es&quot;
		S2=&quot;Galician&quot;
	case &quot;gu&quot;,&quot;gu-in&quot;
		S2=&quot;Gujarati&quot;
	case &quot;ga&quot;,&quot;ga-ie&quot;
		S2=&quot;Irish&quot; 
	case &quot;gd&quot;,&quot;gd-gb&quot;
		S2=&quot;Gaelic&quot;
	case &quot;gsc&quot;,&quot;gsc-fr&quot;
		S2=&quot;Gascon&quot;
	case &quot;gug&quot;,&quot;gug-py&quot;
		S2=&quot;Guarani&quot;
	case &quot;haw&quot;,&quot;haw-us&quot;
		S2=&quot;Hawaiian&quot;
	case &quot;hl&quot;,&quot;hl-gr&quot;
		S2=&quot;Greek&quot;
	case &quot;he&quot;,&quot;he-il&quot;
		S2=&quot;Hebrew&quot;
	case &quot;hr&quot;,&quot;hr-hr&quot;
		S2=&quot;Croatian&quot;
	case &quot;hsb&quot;,&quot;hsb-de&quot;
		S2=&quot;Sorbian, Upper&quot; 
	case &quot;ht&quot;,&quot;ht-ht&quot;
		S2=&quot;Haitian&quot;
	case &quot;hu&quot;,&quot;hu-hu&quot;
		S2=&quot;Hungarian&quot;
	case &quot;ha&quot;,&quot;ha-gh&quot;,&quot;ha-ng&quot;
		S2=&quot;Hausa&quot;
	case &quot;hil&quot;,&quot;hil-ph&quot;
		S2=&quot;Hiligaynon&quot;
	case &quot;ia&quot;,&quot;ia-&quot;
		S2=&quot;Interlingua&quot;
	case &quot;id&quot;,&quot;id-id&quot;
		S2=&quot;Indonesian&quot;
	case &quot;is&quot;,&quot;is-is&quot;
		S2=&quot;Icelandic&quot;
	case &quot;jbo&quot;,&quot;jbo-&quot;
		S2=&quot;Lojban&quot;
	case &quot;jp&quot;,&quot;jp-jp&quot; , &quot;ja&quot;, &quot;ja-jp&quot;
		S2=&quot;Japanese&quot;
	case &quot;kab&quot;,&quot;kab-dz&quot;
		S2=&quot;Kabyle&quot;
	case &quot;ki&quot;,&quot;ki-ke&quot;
		S2=&quot;Gikuyu&quot;
	case &quot;kk&quot;,&quot;kk-kz&quot;
		S2=&quot;Kazak&quot;
	case &quot;kl&quot;,&quot;kl-gl&quot;
		S2=&quot;Kalaallisut&quot;
	case &quot;ksf&quot;,&quot;ksf-cm&quot;
		S2=&quot;Bafia&quot;
	case &quot;ko&quot;,&quot;ko-kp&quot;,&quot;ko-kr&quot;
		S2=&quot;Korean&quot;
	case &quot;ka&quot;,&quot;ka-ge&quot;
		S2=&quot;Georgian&quot;
	case &quot;km&quot;,&quot;km-kh&quot;
		S2=&quot;Khmer&quot;
	case &quot;kn&quot;,&quot;kn-in&quot;
		S2=&quot;Kannada&quot;
	case &quot;kok&quot;,&quot;kok-in&quot;
		S2=&quot;Konkani&quot;
	case &quot;ku&quot;,&quot;ku-sy&quot;,&quot;ku-tr&quot;
		S2=&quot;Kurdish&quot;
	case &quot;ky&quot;,&quot;ky-kg&quot;
		S2=&quot;Kirghiz&quot;
	case &quot;la&quot;,&quot;la-va&quot;
		S2=&quot;Latin&quot;
	case &quot;lb&quot;,&quot;lb-lu&quot;
		S2=&quot;Luxembourgish&quot;
	case &quot;ldi&quot;,&quot;ldi-cg&quot;
		S2=&quot;Lari&quot;
	case &quot;lg&quot;,&quot;lg-ug&quot;
		S2=&quot;Ganda&quot;
	case &quot;ln&quot;,&quot;ln-cd&quot;
		S2=&quot;Lingala&quot;
	case &quot;lo&quot;,&quot;lo-la&quot;
		S2=&quot;Lao&quot;
	case &quot;lt&quot;,&quot;lt-lt&quot;
		S2=&quot;Lithuanian&quot;
	case &quot;ltg&quot;,&quot;ltg-lv&quot;
		S2=&quot;Latgalian&quot;
	case &quot;lv&quot;,&quot;lv-lv&quot;
		S2=&quot;Latvian&quot;
	case &quot;mdw&quot;,&quot;mdw-cg&quot;
		S2=&quot;Mbochi&quot;
	case &quot;mi&quot;,&quot;mi-nz&quot;
		S2=&quot;Maori (New Zealand)&quot;
	case &quot;ms&quot;,&quot;ms-sg&quot;,&quot;ms-my&quot;,&quot;ms-id&quot;,&quot;ms-bn&quot;
		S2=&quot;Malay&quot;
	case &quot;mk&quot;,&quot;mk-mk&quot;
		S2=&quot;Macedonian&quot;
	case &quot;mkw&quot;,&quot;mkw-cg&quot;
		S2=&quot;Kituba&quot;
	case &quot;mn&quot;,&quot;mn-mn&quot;
		S2=&quot;Mongolian&quot;
	case &quot;mo-mn&quot;,&quot;mo&quot;
		S2=&quot;Moldavian&quot;
	case &quot;mos&quot;,&quot;mos-bf&quot;
		S2=&quot;Moore&quot; 
	case &quot;mr&quot;,&quot;mr-in&quot;
		S2=&quot;Marathi&quot;
	case &quot;nds&quot;,&quot;nds-de&quot;
		S2=&quot;Low German&quot;
	case &quot;nl&quot;,&quot;nl-nl&quot;,&quot;nl-be&quot;
		S2=&quot;Dutch&quot;
	case &quot;nn&quot;,&quot;nn-no&quot;
		S2=&quot;Norwegian Norsk&quot; 
	case &quot;nb&quot;,&quot;nb-no&quot;
		S2=&quot;Norwegian Bokmal&quot;
	case &quot;no&quot;,&quot;no-no&quot;
		S2=&quot;Norwegian&quot;
	case &quot;nr&quot;,&quot;nr-za&quot;
		S2=&quot;Ndebele, South&quot;
	case &quot;nso&quot;,&quot;nso-za&quot;
		S2=&quot;Northern Sotho&quot;
	case &quot;ny&quot;,&quot;ny-mw&quot;
		S2=&quot;Nyanja&quot;
	case &quot;oc&quot;,&quot;oc-fr&quot;
		S2=&quot;Occitan&quot;
	case &quot;om&quot;,&quot;om-et&quot;
		S2=&quot;Oromo&quot;
	case &quot;pap&quot;,&quot;pap-aw&quot;,&quot;pap-an&quot;
		S2=&quot;Papiamento&quot;
	case &quot;pl&quot;,&quot;pl-pl&quot;
		S2=&quot;Polish&quot;
	case &quot;pli&quot;,&quot;pli-&quot;
		S2=&quot;Pali&quot;
	case &quot;plt&quot;,&quot;plt-mg&quot;
		S2=&quot;Malagasy&quot;
	case &quot;pt-br&quot;
		S2=&quot;Portuguese (Brazil)&quot;
	case &quot;pt-pt&quot;
		S2=&quot;Portuguese (Portugal)&quot;
	case &quot;pt&quot;
		S2=&quot;Portuguese&quot;
	case &quot;qtz&quot;,&quot;qtz-&quot;
		S2=&quot;KeyID&quot;
	case &quot;qul&quot;,&quot;quh&quot;,&quot;qu&quot;,&quot;qul-bo&quot;,&quot;qu-ec&quot;,&quot;quh-bo&quot;
		S2=&quot;Quechua&quot;
	case &quot;rm&quot;,&quot;rm-ch&quot;
		S2=&quot;Rhaeto-Romance&quot;
	case &quot;ro&quot;,&quot;ro-ro&quot;
		S2=&quot;Romanian&quot;
	case &quot;ru&quot;,&quot;ru-ru&quot;
		S2=&quot;Russian&quot;
	case &quot;rue&quot;,&quot;rue-sk&quot;,&quot;rue-ua&quot;
		S2=&quot;Rusyan&quot;
	case &quot;rw&quot;,&quot;rw-rw&quot;
		S2=&quot;Kinyarwanda&quot;
	case &quot;smn&quot;,&quot;se&quot;,&quot;smj&quot;,&quot;sma&quot;,&quot;smn-fi&quot;,&quot;smn-ru&quot;,&quot;smj-no&quot;,&quot;smj-se&quot;,&quot;se-fi&quot;,&quot;se-no&quot;,&quot;se-se&quot;,&quot;sms-fi&quot;,&quot;sma-no&quot;,&quot;sma-se&quot;
		S2=&quot;Sami&quot;
	case &quot;sh&quot;,&quot;sr&quot;,&quot;sr-me&quot;,&quot;sr-su&quot;,&quot;sr-rs&quot;,&quot;sh-me&quot;,&quot;sh-yu&quot;,&quot;sh-rs&quot;,&quot;sh-su&quot;
		S2=&quot;Serbian&quot;
	case &quot;shs&quot;,&quot;shs-ca&quot;
		S2=&quot;Shuswap&quot;
	case &quot;sk&quot;,&quot;sk-sk&quot;
		S2=&quot;Slovakian&quot;
	case &quot;sl&quot;,&quot;sl-si&quot;
		S2=&quot;Slovene&quot;
	case &quot;so&quot;,&quot;so-so&quot;
		S2=&quot;Somali&quot;
	case &quot;sq&quot;,&quot;sq-al&quot;
		S2=&quot;Albanian&quot;
	case &quot;src&quot;,&quot;src-it&quot;
		S2=&quot;Sardinian (Logudorese)&quot;
	case &quot;sdc&quot;,&quot;sdc-it&quot;
		S2=&quot;Sardinian (Sassarese)&quot;
	case &quot;ss&quot;,&quot;ss-za&quot;
		S2=&quot;Swazi&quot;
	case &quot;st&quot;,&quot;st-za&quot;
		S2=&quot;Southern Sotho&quot;
	case &quot;sw&quot;,&quot;sw-tz&quot;,&quot;sw-ke&quot;
		S2=&quot;Swahili&quot;
	case &quot;swb&quot;,&quot;swb-yt&quot;
		S2=&quot;Maore&quot;
	case &quot;sv&quot;,&quot;sv-se&quot;
		S2=&quot;Swedish&quot;
	case &quot;tek&quot;,&quot;tek-cg&quot;
		S2=&quot;Teke-Ibali&quot;
	case &quot;tet&quot;,&quot;tet-id&quot;,&quot;tet-tl&quot;
		S2=&quot;Tetun&quot;
	case &quot;tg&quot;,&quot;tg-tj&quot;
		S2=&quot;Tajic&quot;
	case &quot;th&quot;,&quot;th-th&quot;
		S2=&quot;Thai&quot;
	case &quot;ti&quot;,&quot;ti-er&quot;,&quot;ti-et&quot;
		S2=&quot;Tigrigna&quot;
	case &quot;tk&quot;,&quot;tk-tm&quot;
		S2=&quot;Turkmen&quot;
	case &quot;tl&quot;,&quot;tl-ph&quot;
		S2=&quot;Tagalog&quot;
	case &quot;tn&quot;,&quot;tn-bw&quot;,&quot;tn-za&quot;
		S2=&quot;Tswana&quot;
	case &quot;tpi&quot;,&quot;tpi-pg&quot;
		S2=&quot;Tok Pisin&quot;
	case &quot;tr&quot;,&quot;tr-tr&quot;
		S2=&quot;Turkish&quot;
	case &quot;tt&quot;,&quot;tt-ru&quot;
		S2=&quot;Tatar&quot;
	case &quot;ts&quot;,&quot;ts-za&quot;
		S2=&quot;Tsonga&quot;
	case &quot;ty&quot;,&quot;ty-pf&quot;
		S2=&quot;Tahitian&quot;
	case &quot;tyx&quot;,&quot;tyx-cg&quot;
		S2=&quot;Teke-Tyee&quot;	
	case &quot;uk&quot;,&quot;uk-ua&quot;
		S2=&quot;Ukranian&quot;
	case &quot;ur&quot;,&quot;ur-in&quot;,&quot;ur-pk&quot;
		S2=&quot;Urdu&quot;
	case &quot;uz&quot;,&quot;uz-uz&quot;
		S2=&quot;Uzbec&quot;
	case &quot;ve&quot;,&quot;ve-za&quot;
		S2=&quot;Venda&quot;
	case &quot;vi&quot;,&quot;vi-vn&quot;
		S2=&quot;Vietnamese&quot;
	case &quot;vif&quot;,&quot;vif-cg&quot;
		S2=&quot;Vili&quot;
	case &quot;wa&quot;,&quot;wa-be&quot;
		S2=&quot;Walloon&quot;
	case &quot;xh&quot;,&quot;xh-za&quot;
		S2=&quot;Xhosa&quot;
	case &quot;yi&quot;,&quot;yi-us&quot;
		s2=&quot;Yiddish&quot;
	case &quot;yo&quot;,&quot;yo-ng&quot;
		S2=&quot;Yoruba&quot;
	case &quot;zh-cn&quot;
		S2=&quot;Chinese (Simplified)&quot;
	case &quot;zh-tw&quot;
		S2=&quot;Chinese (Traditional)&quot;
	case &quot;zh-hk&quot;
		S2=&quot;Chinese (Hong Kong)&quot;
	case &quot;zh-sg&quot;
		S2=&quot;Chinese (Singapore)&quot;
	case &quot;zh-mo&quot;
		S2=&quot;Chinese (Macau)&quot;
	case &quot;zh-yue&quot;,&quot;zh-yu&quot;
		S2=&quot;Chinese (Yue)&quot;
	case &quot;zh&quot;
		S2 = &quot;Chinese&quot;
	case &quot;zu&quot;,&quot;zu-za&quot;
		S2=&quot;Zulu&quot;
	case &quot;zxx&quot;, &quot;zxx-&quot;
		S2 = &quot;Ambiguous Or Missing Language&quot;
	case else  
		S2=S1 &apos; Not Found, So We Return Iso Language Code.
	end select
	Isotoenglish = S2	
end function

Function fsRetrieveCalcActiveCellText() As String
	fsRetrieveCalcActiveCellText=fsRetrieveCalcActiveCellProperty(&quot;String&quot;)
End Function

Function fsSelectionLanguage as String
   	Dim oDoc,oVC,sA,longI,sB,sC,sD
    On Error Goto SELECTLANGUAGEERROR
	oDoc=ThisComponent
	If oDoc.SupportsService(&quot;com.sun.star.sheet.SpreadsheetDocument&quot;) Then
		sA=fsRetrieveCalcActiveCellProperty(&quot;language&quot;)
		sB=fsRetrieveCalcActiveCellProperty(&quot;string&quot;)
		sC=fsRetrieveCalcActiveCellProperty(&quot;asian-language&quot;)
		sD=fsRetrieveCalcActiveCellProperty(&quot;complex-language&quot;)
	Elseif oDoc.supportsService(&quot;com.sun.star.presentation.PresentationDocument&quot;) or oDoc.supportsService(&quot;com.sun.star.drawing.DrawingDocument&quot;) Then
		sA=fsDrawProperty(&quot;language&quot;)
		sB=fsDrawProperty(&quot;string&quot;)
		sC=fsDrawProperty(&quot;asian-language&quot;)
		sD=fsDrawProperty(&quot;complex-language&quot;)
	Else	
		oVC=oDoc.getCurrentController.getViewCursor			
		sA=oVC.CharLocale.Language
		sB=oVC.GetString()
		sC=oVC.CharLocaleAsian.Language
		sD=oVC.CharLocaleComplex.Language
	Endif
	&apos;The application&apos;s built in CharLocale.Language property does not identify oriental or complex text locales
	&apos;so we use the UTF encoding for the first character to evaluate the language. See http://www.utf8-chartable.de/
	&apos;and http://unicode.org/Public/UNIDATA/Blocks.txt
	fsSelectionLanguage=fsUseLanguageType(sA,sB,sC,sD)
	Exit Function
	SELECTLANGUAGEERROR:
	fsSelectionLanguage=fsGetLanguage
End Function

function fsSelectionCountry as String
   	Dim oDoc,oVC,sA,sB,sC,sD
    On Error Goto SELECTCOUNTRYERROR
	oDoc=ThisComponent
	
	If oDoc.SupportsService(&quot;com.sun.star.sheet.SpreadsheetDocument&quot;) Then
		sA=fsRetrieveCalcActiveCellProperty(&quot;country&quot;)
		sB=fsRetrieveCalcActiveCellProperty(&quot;string&quot;)
		sC=fsRetrieveCalcActiveCellProperty(&quot;asian-country&quot;)
		sD=fsRetrieveCalcActiveCellProperty(&quot;complex-country&quot;)
	Elseif oDoc.supportsService(&quot;com.sun.star.presentation.PresentationDocument&quot;) or oDoc.supportsService(&quot;com.sun.star.drawing.DrawingDocument&quot;) Then
		sA=fsDrawProperty(&quot;country&quot;)
		sB=fsDrawProperty(&quot;string&quot;)
		sC=fsDrawProperty(&quot;asian-country&quot;)
		sD=fsDrawProperty(&quot;complex-country&quot;)
	Else	
		oVC=oDoc.getCurrentController.getViewCursor			
		sA=oVC.CharLocale.Country
		sB=oVC.GetString()
		sC=oVC.CharLocaleAsian.Country
		sD=oVC.CharLocaleComplex.Country
	Endif
	
	&apos;The application&apos;s built in CharLocale.Country property does not identify oriental or complex text locales
	&apos;so we use the UTF encoding for the first character to evaluate the country. See http://www.utf8-chartable.de/
	&apos;and http://unicode.org/Public/UNIDATA/Blocks.txt
	fsSelectionCountry=fsUseLanguageType(sA,sB,sC,sD)
	Exit Function
	SELECTCOUNTRYERROR:
	fsSelectionCountry=fsGetCountry
End Function

function fsComplexAsiaOrWest (byval sA)
	dim longI as long
	dim iLocale as integer
	dim sB as string
	dim x as integer
	&apos;Ignore numbers, basic punctuation, telephone network code and western currency symbols
	sB = &quot; 0123456789.,-+÷×—–*#$*%#@(){}|!@&lt;&gt;=[]/:¼½¾&quot;&quot;&apos;“”‘’·€£¥¢¤₠₡₢₣₤₥₦₧₨₩₪₫€₭₮₯₰₱₲₳₴₵₶₷₸₹₺⅓⅔⅛⅜⅝&quot; &amp; Chr$(10) &amp; Chr$(13)
	sA = trim(sA)
	for x = 1 to 100
		if len(sA) &lt;&gt; 0 and instr (sB, left(sA,1)) &lt;&gt; 0 then
			sA = mid(sA,2)
			sA = trim(sA)
		else 
			exit for
		endif
	next
	if sA=&quot;&quot; then
		longI=0
    	else
		longI=asc(sA)
	endif
	if longI &gt;= clng(&quot;&amp;H0000&quot;) And longI &lt;=clng(&quot;&amp;H058F&quot;) then
		iLocale=0
	&apos;Asian characters
	elseif longI &gt;=clng(&quot;&amp;H3400&quot;) And longI &lt;=clng(&quot;&amp;H9FFF&quot;) then
		iLocale=1 &apos;zh, ja or ko 
	elseif longI &gt;=clng(&quot;&amp;H3040&quot;) And longI &lt;=clng(&quot;&amp;H31FF&quot;) then
   		iLocale=1 &apos; &quot;ja&quot;
   	elseif longI &gt;=asc(&quot;･&quot;) And longI &lt;=asc(&quot;ﾟ&quot;) then
   		iLocale=1 &apos; &quot;ja&quot;
   	elseif longI &gt;=clng(&quot;&amp;HAC00&quot;) And longI &lt;=clng(&quot;&amp;HD7A3&quot;) then
   		iLocale=1 &apos; &quot;ko&quot;
  	elseif longI &gt;=clng(&quot;&amp;HFFA0&quot;) And longI &lt;=clng(&quot;&amp;HFFDC&quot;) then
   		iLocale=1 &apos; &quot;ko&quot;
   	&apos;Complex characters
  	elseif longI = clng(&quot;&amp;H02BC&quot;) then
   		iLocale=2 &apos; Dogri, Bodo, Maithili
  	elseif longI &gt;=clng(&quot;&amp;H1750&quot;) And longI &lt;=clng(&quot;&amp;H17FF&quot;) then
   		iLocale=2 &apos; Khmer, Thaana, Dhiveh, Urdu
  	elseif longI &gt;=clng(&quot;&amp;HFB50&quot;) And longI &lt;=clng(&quot;&amp;HFDFF&quot;) then
   		iLocale=2 &apos; Urdu
  	elseif longI &gt;=clng(&quot;&amp;HFE70&quot;) And longI &lt;=clng(&quot;&amp;HFEFF&quot;) then
   		iLocale=2 &apos; Urdu
  	elseif longI &gt;=clng(&quot;&amp;H19E0&quot;) And longI &lt;=clng(&quot;&amp;H19FF&quot;) then
   		iLocale=2 &apos; &quot;km&quot; &apos; Khmer symbols
 	elseif longI &gt;=clng(&quot;&amp;H0600&quot;) And longI &lt;=clng(&quot;&amp;H06FF&quot;) then
   		iLocale=2 &apos; Farsi, Arabic, Kashmiri, Kurdish
   	elseif longI &gt;=clng(&quot;&amp;H0900&quot;) And longI &lt;=clng(&quot;&amp;H0972&quot;) then
   		iLocale=2 &apos; Devanagari for Hindi or other Indic languages
   	elseif longI &gt;=clng(&quot;&amp;H0591&quot;) And longI &lt;=clng(&quot;&amp;H05F4&quot;) then
   		iLocale=2 &apos; &quot;he&quot; &apos; Hebrew - no voice for Google Translate
   	elseif longI &gt;=clng(&quot;&amp;H0A00&quot;) And longI &lt;=clng(&quot;&amp;H0AFF&quot;) then
   		iLocale=2 &apos; &quot;pa&quot; &apos; Gurmukhi script is probably Punjabi
   	elseif longI &gt;=clng(&quot;&amp;H0980&quot;) And longI &lt;=clng(&quot;&amp;H09FF&quot;) then
   		iLocale=2 &apos;Bengali
   	elseif longI &gt;=clng(&quot;&amp;H0A80&quot;) And longI &lt;=clng(&quot;&amp;HOD7F&quot;) then
   		iLocale=2 &apos;Gurjarti, Oriya, Tamil, Telugu, Kannada, Malayalam
   	elseif longI &gt;=clng(&quot;&amp;H1000&quot;) And longI &lt;=clng(&quot;&amp;H109F&quot;) then
   		iLocale=2 &apos;Burmese (Myanmar)
   	elseif longI &gt;=clng(&quot;&amp;H0E00&quot;) And longI &lt;=clng(&quot;&amp;H0FFF&quot;) then
   		iLocale=2 &apos;Thai, Lao, Tibetan, Dzongkha
   	elseif longI &gt;=clng(&quot;&amp;H1200&quot;) And longI &lt;=clng(&quot;&amp;H139F&quot;) then
   		iLocale=2 &apos;Ethiopic, Ethiopic Supplement
   	elseif longI &gt;=clng(&quot;&amp;H1700&quot;) And longI &lt;=clng(&quot;&amp;H171F&quot;) then
   		iLocale=2 &apos;Limbu
   	elseif longI &gt;=clng(&quot;&amp;H2D80&quot;) And longI &lt;=clng(&quot;&amp;H2DDF&quot;) then
   		iLocale=2 &apos;Ethopic Extended
   	else &apos;western
		iLocale=0
	endif
	select case iLocale
	case 0
		if fbIsAnURL(sA) then
			fsComplexAsiaOrWest=&quot;UNDEFINED&quot;
		else  &apos;
			fsComplexAsiaOrWest=&quot;WEST&quot;
		endif
	case 1
		fsComplexAsiaOrWest=&quot;ASIA&quot;
	case else 
		fsComplexAsiaOrWest=&quot;COMPLEX&quot;
	end select
end function

function fsUseLanguageType( sA,sB,sC,sD)
	dim sE as string
	sE = fsComplexAsiaOrWest(sB)
	
	select case sE
	case &quot;ASIA&quot;
		fsUseLanguageType=sC
	case &quot;COMPLEX&quot;
		fsUseLanguageType=sD
	case else &apos; &quot;WEST&quot; or &quot;UNDEFINED&quot;
		fsUseLanguageType=sA
	end select
	
end function

Function fsDrawText() As String
	&apos;Function To get text selection in a drawing or a presentation slide
	fsDrawText=fsDrawProperty(&quot;String&quot;)
End Function

Function fsDrawProperty(strA) As String
	Dim oDoc As Object
	Dim oController As Object
	Dim oSelection As Object
	Dim s1r As String
	s1r=&quot;&quot;
	oDoc=ThisComponent
	oController=oDoc.getCurrentController()
	oSelection=oController.getSelection() 
	If oSelection.supportsService(&quot;com.sun.star.text.TextCursor&quot;) Then
	Select Case strA
	Case &quot;country&quot;
		s1r=oSelection.CharLocale.Country  
	Case &quot;language&quot;
		s1r=oSelection.CharLocale.Language
	Case &quot;asian-language&quot;
		s1r=oSelection.CharLocaleAsian.Language
	Case &quot;complex-language&quot;
		s1r=oSelection.CharLocaleComplex.Language
	Case &quot;asian-country&quot;
		s1r=oSelection.CharLocaleAsian.Country
	Case &quot;complex-country&quot;
		s1r=oSelection.CharLocaleComplex.Country
	Case Else
	s1r=oSelection.getString()
		End Select
	EndIf
	fsDrawProperty=s1r
End Function

Sub MsgSpeak(strA As String)
	Dim sFile As String
	Dim msgs() As Variant
	Dim errorCode As Integer 
	Dim config(fiCountConfigOptions) As Variant
	sFile=fsFullPathOf(fsExtensionSettingsIni)	
	If fileExists(sFile) Then
		tts_config_parseFile(sFile,config(),errorCode)
		ttsActuate(config(),msgs(),errorCode,strA)
	Else 
		ConfigureReadTextAloud
	Endif	
End Sub

Function fsEscapeStr(sA As String) As String
	if  fsGetOS()=&quot;OSX&quot; Or fsGetOS()=&quot;MAC&quot; Then 
		sA=fsreplaceText(sA,&quot;+&quot;,&quot;＋&quot;) &apos;http://www.fileformat.info/info/unicode/char/ff0b/index.htm 
		sA=fsreplaceText(sA,&quot;&amp;&quot;,&quot;＆&quot;) &apos;http://www.fileformat.info/info/unicode/char/ff06/index.htm
		fsEscapeStr=sA
	else 
		sA=fsreplaceText(sA,&quot;+&quot;,&quot;%2B&quot;)
		sA=fsreplaceText(sA,&quot;&amp;&quot;,&quot;%26&quot;)
		Select Case LCase(Left(ConvertToURL(sA),Instr(ConvertToURL(sA),&quot;:&quot;)))
		Case &quot;file:&quot;
			fsEscapeStr=Mid(ConvertToURL(sA),9)
		Case Else
			fsEscapeStr=sA
		End Select
	endif
End Function

Function fsLang As String
	&apos; Full Language String - en-US en-GB zh-CN zh-TW etc
	Dim SubstService As Variant
	SubstService=CreateUnoService(&quot;com.sun.star.util.PathSubstitution&quot;)
	fsLang=SubstService.substituteVariables(&quot;$(vlang)&quot;,True)
End Function

Function fsOptDirectory As String
	If fsGetOS=&quot;WINDOWS&quot; Then
		fsOptDirectory= fsHomeDrive() &amp; &quot;\opt\&quot;
	Else
		fsOptDirectory=&quot;/opt/&quot;
	Endif
End Function

Function fsHomeDrive As String
	fsHomeDrive=Environ(&quot;HOMEDRIVE&quot;)
	If fsHomeDrive=&quot;&quot; Then
		If fsGetOS=&quot;WINDOWS&quot; Then
			fsHomeDrive=&quot;C:&quot;
		Else
			fsHomeDrive=&quot;&quot;
		EndIf
	Endif
End Function

Function fsProgramDirectory As String
	Dim c As String
	c=Environ(&quot;ProgramFiles&quot;)
	If Instr(c,&quot;\&quot;) &lt;&gt; 0 Then
		fsProgramDirectory=c &amp; &quot;\&quot;
	Else
		fsProgramDirectory=&quot;/usr/bin/&quot;
	Endif
End Function

Function fsProgramDirectoryx86 As String
	Dim c As String
	c=Environ(&quot;ProgramFiles(x86)&quot;)
	If Instr(c,&quot;\&quot;) &lt;&gt; 0 Then
		fsProgramDirectoryx86=c &amp; &quot;\&quot;
	Else
		fsProgramDirectoryx86=&quot;/usr/bin/&quot;
	Endif
End Function

Function fsInstallPath As String
	Dim SubstService As Variant
	SubstService=CreateUnoService(&quot;com.sun.star.util.PathSubstitution&quot;)
	fsInstallPath=SubstService.substituteVariables(&quot;$(inst)&quot;,True)
End Function

Function fbIsAMediaPlayer(s1 As String) As Boolean
	Dim n As Integer
	s1=Lcase(s1)
	fbIsAMediaPlayer=False
	For n=0 To fiCountMediaPlayers
		If Instr(s1,fsMediaPlayer(n)) &gt; 0 Then
			fbIsAMediaPlayer=True
			Exit For
		Endif
	Next
End Function

Sub myBeep
	Dim sA As String
	sA=soundsDirectory()&amp;&quot;apert.wav&quot;
	if fileExists (sA) then
    	sA=convertToURL(sA)
    elseif fileExists (&quot;/usr/share/sounds/alsa/Noise.wav&quot;) then
    	sA=convertToURL(&quot;/usr/share/sounds/alsa/Noise.wav&quot;)
    else
    	sA=convertToURL(&quot;/usr/share/sounds/speech-dispatcher/test.wav&quot;)
    endif
	Dim oSvc As Object
	oSvc=createUnoService(&quot;com.sun.star.system.SystemShellExecute&quot;)
	oSvc.execute(sA,&quot;&quot;,1)
End Sub

Sub windowsSAPIControl
    Dim s2 As String
	Dim oSvc As Object
	oSvc=createUnoService(&quot;com.sun.star.system.SystemShellExecute&quot;)
    s2=fsHomeDrive()
	If fileExists(s2 &amp; &quot;\Windows\SysWOW64\Speech\SpeechUX\sapi.cpl&quot;) Then
		oSvc.execute(s2 &amp; &quot;\Windows\SysWOW64\Speech\SpeechUX\sapi.cpl&quot;,&quot;&quot;,0)
	Elseif fileExists(s2 &amp; &quot;\Windows\System32\Speech\SpeechUX\sapi.cpl&quot;) Then
		oSvc.execute(s2 &amp; &quot;\Windows\System32\Speech\SpeechUX\sapi.cpl&quot;,&quot;&quot;,0)
	Elseif fileExists(fsProgramDirectory() &amp; &quot;Common Files\Microsoft Shared\Speech\sapi.cpl&quot;) Then
		oSvc.execute(fsProgramDirectory() &amp; &quot;Common Files\Microsoft Shared\Speech\sapi.cpl&quot;,&quot;&quot;,0)
	Elseif fileExists(s2 &amp; &quot;\WINDOWS\ServicePackFiles\i386\sapi.cpl&quot;) Then
		oSvc.execute(s2 &amp; &quot;\WINDOWS\ServicePackFiles\i386\sapi.cpl&quot;,&quot;&quot;,0)
	Elseif fileExists(s2 &amp; &quot;\Windows\System32\access.cpl&quot;) Then
		oSvc.execute(s2 &amp; &quot;\Windows\System32\access.cpl&quot;,&quot;&quot;,0)
	Elseif fileExists(&quot;/usr/bin/systemsettings&quot;) Then &apos;kde
		Shell(&quot;/usr/bin/systemsettings&quot;,0,&quot;&quot;,False)
	Elseif fileExists(&quot;/usr/bin/xfce-setting-show&quot;) Then &apos;xfce
		Shell(&quot;/usr/bin/xfce-setting-show&quot;,0,&quot;&quot;,False)
	Elseif fileExists(&quot;/usr/bin/gnome-control-center&quot;) Then &apos;gnome
		Shell(&quot;/usr/bin/gnome-control-center&quot;,0,&quot;&quot;,False)
	Elseif fileExists(&quot;/usr/bin/unity-control-center&quot;) Then &apos;ubuntu
		Shell(&quot;/usr/bin/unity-control-center&quot;,0,&quot;&quot;,False)
	Elseif fsGetOS()=&quot;OSX&quot; Or fsGetOS()=&quot;MAC&quot; Then &apos;osx
		Shell(&quot;open&quot;,0,&quot;-b com.apple.systempreferences&quot;,False)
	EndIf
End Sub

Sub libreHelp
	&apos; LibreOffice does not show an extension&apos;s help documents if the application&apos;s help documents
	&apos; are not installed. In this case, we show web based extension help in a browser window
	Select Case fbHelpIsInstalled()
	Case False
		WebHelp()
	Case Else
		&apos;Don&apos;t do anything; extension can use ordinary help.
	End Select
End Sub

function fbCreateFile(sFilePath, sWriteString, Optional sEncoding)
	&apos; fbCreateFile (&quot;/tmp/sample.txt&quot;,&quot;Hello world&quot;,&quot;utf-8&quot;) &apos; Best practice
	&apos; fbCreateFile (&quot;/tmp/sample.txt&quot;,&quot;Hello world&quot;) &apos; is allowed, but not best practice.
	&apos; Windows can not write Asian languages correctly with &quot;iso-8859-15&quot;
	&apos; Anything written for the extension&apos;s private use should be &quot;utf-8&quot;
	&apos; This sub will create the file and all the nested directories
	&apos; in the path in a single step.
	if ismissing(sEncoding) then 
		select case fsGetOS()
		case &quot;WINDOWS&quot;
			sEncoding = &quot;iso-8859-15&quot; &apos;iso-8859-15 is Windows &quot;western&quot; encoding
		case else 
			sEncoding = &quot;utf-8&quot; &apos; Posix standard
		end select
	endif
	on Error goto fbCreateFileError
 	dim CR as string
	CR = Chr$(13)
	dim oOutputAccess As object
	dim oOutputStream As object
	dim vOutputData, UDP, PV As Variant
	if fileExists (sFilePath) then
		kill sFilePath
	endif
	oOutputAccess = CreateUnoService(&quot;com.sun.star.ucb.SimpleFileAccess&quot;)
	oOutputStream = CreateUnoService(&quot;com.sun.star.io.TextOutputStream&quot;)
	vOutputData   = oOutputAccess.openFileWrite( sFilePath )
	oOutputStream.setOutputStream(vOutputData)
	oOutputStream.setEncoding(sEncoding)
	oOutputStream.writeString( sWriteString )
	oOutputStream.flush()
	oOutputStream.closeOutput()
	fbCreateFile = true
	exit function
	fbCreateFileError:
	fbCreateFile = false
end function

function fsNow
	&apos; see http://www.ietf.org/rfc/rfc3339.txt
	&apos; see Unix man date
	&apos; local time - doesn&apos;t work in OSX
	&apos; shell( &quot;bash -c &apos;date +%F-T%X%:z &gt;  &quot;&quot;$HOME/date.txt&quot;&quot;&apos;&quot;)
	&apos; utc time - works in OSX and Linux 
	&apos; shell( &quot;bash -c &apos;date -u +%F-T%X-00:00 &gt; &quot;&quot;$HOME/date.txt&quot;&quot;&apos;&quot;)
	dim sA as string
	sA= year(now) &amp; &quot;-&quot; &amp; _
	fsPrefixZeroes(month(now),2) &amp; &quot;-&quot; &amp; _
	fsPrefixZeroes(day(now),2) &amp; &quot;T&quot; &amp; _
	fsPrefixZeroes(hour(now),2) &amp; &quot;:&quot; &amp; _
	fsPrefixZeroes(minute(now),2) &amp; &quot;:&quot; &amp; _
	fsPrefixZeroes(second(now),2)
	fsNow = sA
end function

function fsPrefixZeroes (s1,n1)
	&apos; s1 is the stringto prefix zeroes with 
	&apos; n1 is the minimum length of the return string
	dim s2 as string
	if n1 &lt; 1000 and len(s1) &lt; n1 then &apos; sanity check
		s2=String(n1,&quot;0&quot;) &amp; s1
		fsPrefixZeroes=right(s2,n1)
	else 
		fsPrefixZeroes=s1
	endif
end function

function fswriteOSXSpeechScript (byval sArguments, byval sArgLangLocale)
	dim sLang, sLangLocale, sBaseCountry as string
	dim CR,sA,sB,sF,sFile,sEncoding, sSize, sMeta as string
	dim errorCode
	CR = Chr$(13)
	sLangLocale = &quot;&quot;
	sBaseCountry = &quot;&quot;
	&apos; Classic 35 mm camera format looks good on a HDMI screen or a full screen MacBook Pro.
	&apos; See presets: http://develop.participatoryculture.org/index.php/ConversionMatrix
	sSize = &quot;1200x800&quot; &apos; DSLR
	&apos; sSize = &quot;640x480&quot; &apos; VGA projector or NTSC broadcast 4:3
	&apos; sSize = &quot;720x576 &quot; &apos; PAL broadcast
	&apos; sSize = &quot;1366x768&quot; &apos; Windows laptop 16:9
	&apos; sSize = &quot;1280x800&quot; &apos; Apple MacBook
	&apos; sSize = &quot;1440x900&quot; &apos; Apple MacBook Air
	&apos; sSize = &quot;1920x1080&quot; &apos; 1080p High Def TV 16:9
	sMeta = &quot; -metadata title=&quot;&quot; &amp; (quoted form of &quot;&quot;&quot; &amp; fsThisDocTitle() &amp; _
		&quot;&quot;&quot;) &amp; &quot;&quot; -metadata Year=&quot;&quot; &amp; (quoted form of &quot;&quot;&quot; &amp; year(now) &amp; _
		&quot;&quot;&quot;) &amp; &quot;&quot; -metadata artist=&quot;&quot; &amp; (quoted form of &quot;&quot;&quot; &amp; fsThisDocAuthor() &amp; _
		&quot;&quot;&quot;) &amp; &quot;&quot; -metadata album=&quot;&quot; &amp; (quoted form of &quot;&quot;[&quot; &amp; fsStringLanguage(0,fsGetLanguage()) &amp; &quot;](&quot; &amp; fsStringLanguage(18 ,fsGetLanguage()) &amp; &quot;)&quot;&amp; _
		&quot;&quot;&quot;) &amp; &quot;&quot; -metadata genre=&quot;&quot; &amp; (quoted form of &quot;&quot;Speech&quot;&quot;)&quot;
	if fileExists (fsTemporaryTtsAppleScript) then
		kill fsTemporaryTtsAppleScript
	endif
	sA = &quot;(*&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;Read Text&quot; &amp; CR &amp; _
		&quot;=========&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;**Read Text** reads text aloud, saves audio or video files&quot; &amp; CR &amp; _
		&quot;from text, and can use resources from the web based on the&quot; &amp; CR &amp; _
		&quot;selected text.&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot; * Select text.&quot; &amp; CR &amp; _
		&quot; * Click the *Read selection...* button.&quot; &amp; CR &amp; _
		&quot; * To read aloud, accept the default in the dialogue, or choose&quot; &amp; CR &amp; _
		&quot;   another action from the menus.&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;Read Aloud&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;     &quot;&quot;(SAY_APPLESCRIPT)&quot;&quot;&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;Record&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;     &quot;&quot;(SAY_APPLESCRIPT)&quot;&quot; &quot;&quot;(HOME)(NOW).aiff&quot;&quot;&quot; &amp; CR &amp; _
		&quot;     &quot;&quot;(SAY_APPLESCRIPT)&quot;&quot; &quot;&quot;(HOME)(NOW).m4a&quot;&quot;&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;Record an image with sound using Miro (`ffmpeg` or `avconv`)&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;     &quot;&quot;(SAY_APPLESCRIPT)&quot;&quot; &quot;&quot;(HOME)(NOW).webm&quot;&quot; &quot;&quot;(MY_IMAGE)&quot;&quot;&quot; &amp; CR &amp; _
		&quot;     &quot;&quot;(SAY_APPLESCRIPT)&quot;&quot; &quot;&quot;(HOME)(NOW).webm&quot;&quot; &quot;&quot;(MY_IMAGE)&quot;&quot; &quot;&quot;640x480&quot;&quot;&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;Features&quot; &amp; CR &amp; _
		&quot;--------&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot; * Automatically change languages according to the text language.&quot; &amp; CR &amp; _
		&quot; * Create sound or still-image speech files for listening on the go.&quot; &amp; CR &amp; _
		&quot; * Use web resources to translate, look up, listen, post, or interface&quot; &amp; CR &amp; _
		&quot;   with web application interfaces.&quot; &amp; CR &amp; _
		&quot; * **Miro Video Converter** can convert mp3, ogg, webm and other media using `ffmpeg`&quot; &amp; CR &amp; _
		&quot;   Once installed, read text can use it to make audio and video media files&quot; &amp; CR &amp; _
		&quot;   for cross-platform web browsers like chromium, chrome, and firefox.&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;###Miro and ffmpeg&quot; &amp; CR &amp; _
		&quot;&quot;  &amp; CR &amp; _
		&quot; * [ffmpeg](http://https://www.ffmpeg.org)&quot; &amp; CR &amp; _
		&quot; * [Miro](http://ftp.osuosl.org/pub/pculture.org/miro/)&quot; &amp; CR &amp; _
		&quot; * [Miro formats](http://develop.participatoryculture.org/index.php/ConversionMatrix)&quot; &amp; CR &amp; _
		&quot; * [Miro video converter](http://ftp.osuosl.org/pub/pculture.org/mirovideoconverter/)&quot; &amp; CR &amp; _
		&quot; * [Participatory culture foundation](http://pculture.org/)&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;Installation&quot; &amp; CR &amp; _
		&quot;------------&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;Install *Read Text* by installing the extension from the download page:&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot; * [Apache OpenOffice](http://extensions.services.openoffice.org/en/project/read-text)&quot; &amp; CR &amp; _
		&quot; * [LibreOffice](http://extensions.libreoffice.org/extension-center/read-text)&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;License&quot; &amp; CR &amp; _
		&quot;-------&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;The project is licensed under the [GNU 2.0](http://www.gnu.org/licenses/gpl-2.0.txt) license.&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;Online help&quot; &amp; CR &amp; _
		&quot;-----------&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;[Read Text](https://sites.google.com/site/readtextextension/)&quot; &amp; CR &amp; _
		&quot;&quot; &amp; CR &amp; _
		&quot;*)&quot; &amp; CR
	if sArguments &lt;&gt; &quot;&quot; then
		if instr(sArguments, &quot;AirPlay&quot;) &lt;&gt; 0 then
			sA = &quot;(*&quot; &amp; CR &amp; _
				&quot;AirPlay&quot; &amp; CR &amp; _
				&quot;=======&quot; &amp; CR &amp; _
				&quot;&quot; &amp; CR &amp; _
				&quot;     &quot;&quot;(SAY_APPLESCRIPT_AIRPLAY)&quot;&quot;&quot;  &amp; CR &amp; _
				&quot;&quot; &amp; CR &amp; _
				&quot;The AirPlay option lets you send the audio output of your computer&apos;s &quot; &amp; _
				&quot;speech synthesizer to a compatible player without sharing your desktop screen. &quot; &amp; CR &amp; _
				&quot;&quot; &amp; CR &amp; _
				&quot;Make sure that your AirPlay monitor is on and that your computer is &quot; &amp; _
				&quot;set to use the *correct* AirPlay device. Check the AirPlay device &quot; &amp; _	
				&quot;by clicking the *AirPlay* monitor icon on your computer&apos;s menu bar.&quot; &amp; CR &amp; _
				&quot;&quot; &amp; CR &amp; _
				&quot;Online help&quot; &amp; CR &amp; _
				&quot;-----------&quot; &amp; CR &amp; _
				&quot;&quot; &amp; CR &amp; _
				&quot;[Troubleshooting AirPlay](http://support.apple.com/en-us/HT203822)  &quot; &amp; CR &amp; _
				&quot;[Troubleshooting Apple TV](http://support.apple.com/en-us/HT200197)  &quot; &amp; CR &amp; _
				&quot;&quot; &amp; CR &amp; _
				&quot;*)&quot; &amp; CR
		endif
	endif
	sF = ConvertFromURL(fsFullPathOf(fsTemporaryTextDoc))
	&apos; We use the system voice if the selected language is the same as the user interface
	&apos; language. You can choose a specific voice for your primary working language using
	&apos; the system preferences for speech. Secondary languages use voices chosen to match
	&apos; language and region. We recommend you install the optional high quality voice for
	&apos; any voice you use regularly.

	if sArgLangLocale = &quot;&quot; then
		sLangLocale = &quot;&quot;
	else
		sLang = fsGetLanguage() &amp; &quot;-&quot; &amp;  fsGetCountry()
		sBaseCountry = mid(sArgLangLocale, instr(sArgLangLocale,&quot;-&quot;)+1)		
		select case sArgLangLocale
		case &quot;&quot;, sLang,  fsGetLanguage() &amp; &quot;-&quot; &amp; sBaseCountry
			sLangLocale = &quot;&quot; 
		case else
			sLangLocale=fsReplaceText(sArgLangLocale,&quot;-&quot;,&quot;_&quot;)
		end select
	endif
	sB =&quot;#/usr/bin/osascript&quot; &amp; CR &amp; sA &amp; _
		&quot;-- ------------------------------------------------------&quot; &amp; CR &amp; _
		&quot;-- Read Text Extension created this script&quot; &amp; CR &amp; _
		&quot;-- using &quot; &amp; fsGetSetting(&quot;ooname&quot;) &amp; &quot; &quot; &amp; fsNow &amp; CR &amp; _
		&quot;-- ------------------------------------------------------&quot; &amp; CR &amp; _
		&quot;on run (arguments)&quot; &amp; CR &amp; _
		&quot;	set argv1 to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set argv2 to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set argv3 to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set astring to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set b to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _	
		&quot;	set cout1 to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _	
		&quot;	set cout2 to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _	
		&quot;	set defaultPng to &quot;&quot;&quot; &amp; ConvertFromURL(fsPoster2Png) &amp; &quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set defaultSize to &quot;&quot;&quot; &amp; sSize &amp; &quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set doPostProcess to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _	
		&quot;	set doPostProcess2 to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set err1 to &quot;&quot;Apple Script&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set ffmeta to &quot;&quot;&quot; &amp; sMeta &amp; CR &amp; _
		&quot;	set myConverter to &quot;&quot;&quot; &amp; fsMyFfmpeg &amp; &quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set myLang to &quot;&quot;&quot; &amp; sLangLocale &amp; &quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set myLock to quoted form of POSIX path of &quot;&quot;&quot; &amp; fsMyTempLock &amp; &quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set myOption to &quot;&quot;&quot; &amp; sArguments &amp; &quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	set textFile to &quot;&quot;&quot; &amp; sF &amp; &quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;-- ------------------------------------------------------&quot; &amp; CR &amp; _
		&quot;	set b to (do shell script &quot;&quot;touch &apos;&quot;&quot; &amp; myLock &amp; &quot;&quot;&apos;&quot;&quot;)&quot; &amp; CR &amp; _		
		&quot;	try&quot; &amp; CR &amp; _
		&quot;		set argv1 to (item 1 of arguments)&quot; &amp; CR &amp; _
		&quot;		set astring to fsChangeCase(getExtension(argv1),&quot;&quot;lower&quot;&quot;)&quot; &amp; CR &amp; _
		&quot;	on error&quot; &amp; CR &amp; _
		&quot;		set argv1 to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	end try&quot; &amp; CR &amp; _
		&quot;	try&quot; &amp; CR &amp; _
		&quot;		set argv2 to (item 2 of arguments)&quot; &amp; CR &amp; _
		&quot;	on error&quot; &amp; CR &amp; _
		&quot;		set argv2 to defaultPng&quot; &amp; CR &amp; _
		&quot;	end try&quot; &amp; CR &amp; _
		&quot;	try&quot; &amp; CR &amp; _
		&quot;		set argv3 to (item 3 of arguments)&quot; &amp; CR &amp; _
		&quot;	on error&quot; &amp; CR &amp; _
		&quot;		set argv3 to defaultSize&quot; &amp; CR &amp; _
		&quot;	end try&quot; &amp; CR &amp; _
		&quot;	if astring is &quot;&quot;m4a&quot;&quot; or astring is &quot;&quot;aif&quot;&quot; or astring is &quot;&quot;aiff&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;		set doPostProcess to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _	
		&quot;	else if myConverter is not &quot;&quot;&quot;&quot; then&quot; &amp; CR &amp; _			
		&quot;		if astring is &quot;&quot;mp3&quot;&quot; or astring is &quot;&quot;ogg&quot;&quot; or astring is &quot;&quot;wav&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;			set cout1 to argv1&quot; &amp; CR &amp; _
		&quot;			set argv1 to argv1 &amp; &quot;&quot;.aif&quot;&quot;&quot; &amp; CR &amp; _
		&quot;			set doPostProcess to (quoted form of POSIX path of myConverter) &amp; &quot;&quot; -i &quot;&quot; &amp; (quoted form of POSIX path of argv1) &amp; ffmeta &amp; &quot;&quot; -y &quot;&quot; &amp; (quoted form of POSIX path of cout1)&quot; &amp; CR &amp; _
		&quot;		else if astring is &quot;&quot;webm&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;			set cout1 to argv1&quot; &amp; CR &amp; _
		&quot;			set argv1 to argv1 &amp; &quot;&quot;.aif&quot;&quot;&quot; &amp; CR &amp; _
		&quot;			set doPostProcess to (quoted form of POSIX path of myConverter) &amp; &quot;&quot; -i &quot;&quot; &amp; (quoted form of POSIX path of argv1) &amp; &quot;&quot; -f image2 -i &quot;&quot; &amp; (quoted form of POSIX path of argv2) &amp; &quot;&quot; -s &quot;&quot; &amp; argv3 &amp; &quot;&quot; -vcodec libvpx -g 120 -lag-in-frames 16 -deadline good -cpu-used 0 -vprofile 0 -qmax 63 -qmin 0 -b:v 768k -acodec libvorbis -ab 112k -ar 44100 -f webm -y &quot;&quot; &amp; (quoted form of POSIX path of cout1)&quot; &amp; CR &amp; _
		&quot;		else if astring is &quot;&quot;mp4&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;			set cout1 to argv1&quot; &amp; CR &amp; _
		&quot;			set argv1 to argv1 &amp; &quot;&quot;.aif&quot;&quot;&quot; &amp; CR &amp; _
		&quot;			set cout2 to cout1 &amp; &quot;&quot;.webm&quot;&quot;&quot; &amp; CR &amp; _
		&quot;			set err1 to cout2&quot; &amp; CR &amp; _
		&quot;			set doPostProcess to (quoted form of POSIX path of myConverter) &amp; &quot;&quot; -i &quot;&quot; &amp; (quoted form of POSIX path of argv1) &amp; &quot;&quot; -f image2 -i &quot;&quot; &amp; (quoted form of POSIX path of argv2) &amp; &quot;&quot; -s &quot;&quot; &amp; argv3 &amp; &quot;&quot; -vcodec libvpx -g 120 -lag-in-frames 16 -deadline good -cpu-used 0 -vprofile 0 -qmax 63 -qmin 0 -b:v 768k -acodec libvorbis -ab 112k -ar 44100 -f webm -y &quot;&quot; &amp; (quoted form of POSIX path of cout2)&quot; &amp; CR &amp; _
		&quot;			set doPostProcess2 to (quoted form of POSIX path of myConverter) &amp; &quot;&quot; -i &quot;&quot; &amp; (quoted form of POSIX path of cout2) &amp; &quot;&quot; -acodec aac -ab 160k -s &quot;&quot; &amp; argv3 &amp; &quot;&quot; -vcodec libx264 -preset slow -profile:v baseline -level 30 -maxrate 10000000 -bufsize 10000000 -f mp4 -threads 0 -strict experimental &quot;&quot; &amp; ffmeta &amp; &quot;&quot; -y &quot;&quot; &amp; (quoted form of POSIX path of cout1)&quot; &amp; CR &amp; _
		&quot;		else&quot; &amp; CR &amp; _
		&quot;			set argv1 to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;		end if&quot; &amp; CR &amp; _		
		&quot;	else&quot; &amp; CR &amp; _
		&quot;		set argv1 to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	end if&quot; &amp; CR &amp; _		
		&quot;	if myLang is &quot;&quot;&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;		set myVoice to &quot;&quot;System&quot;&quot;&quot; &amp; CR &amp; _
		&quot;		set myLang to &quot;&quot;Default Language&quot;&quot;&quot; &amp; CR &amp; _
		&quot;		set myVoiceCommand to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	else&quot; &amp; CR &amp; _
		&quot;		set myVoice to fsGetthevoice(myLang)&quot; &amp; CR &amp; _
		&quot;		set myVoiceCommand to &quot;&quot; --voice &apos;&quot;&quot; &amp; myVoice &amp; &quot;&quot;&apos;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	end if&quot; &amp; CR &amp; _	
		&quot;	try&quot; &amp; CR &amp; _
		&quot;		if argv1 is &quot;&quot;&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;			if isInString(myOption, &quot;&quot;AirPlay&quot;&quot;) then&quot; &amp; CR &amp; _
		&quot;				set err1 to &quot;&quot;AirPlay&quot;&quot;&quot; &amp; CR &amp; _
		&quot;				theMsg (&quot;&quot;AirPlay&quot;&quot;, myVoice, myLang, &quot;&quot;Purr&quot;&quot;)&quot; &amp; CR &amp; _
		&quot;			end if&quot; &amp; CR &amp; _
		&quot;			set b to (do shell script &quot;&quot;say &quot;&quot; &amp; myOption &amp; myVoiceCommand &amp; &quot;&quot; -f &apos;&quot;&quot; &amp; textFile &amp; &quot;&quot;&apos; &quot;&quot;)&quot; &amp; CR &amp; _		
		&quot;		else&quot; &amp; CR &amp; _
		&quot;			set err1 to &quot;&quot;Audio file&quot;&quot;&quot; &amp; CR &amp; _
		&quot;			set b to (do shell script &quot;&quot;say &quot;&quot; &amp; myOption &amp; &quot;&quot; -o &quot;&quot; &amp; argv1 &amp; myVoiceCommand &amp; &quot;&quot; -f &apos;&quot;&quot; &amp; textFile &amp; &quot;&quot;&apos; &quot;&quot;)&quot; &amp; CR &amp; _
		&quot;			if doPostProcess is not &quot;&quot;&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;				set err1 to &quot;&quot;ffmpeg &quot;&quot; &amp; astring &amp; &quot;&quot; encode&quot;&quot;&quot; &amp; CR &amp; _
		&quot;				set b to (do shell script doPostProcess)&quot; &amp; CR &amp; _
		&quot;				if doPostProcess2 is not &quot;&quot;&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;					set err1 to &quot;&quot;ffmpeg [2] &quot;&quot; &amp; astring &amp; &quot;&quot; encode&quot;&quot;&quot; &amp; CR &amp; _
		&quot;					set b to (do shell script doPostProcess2)&quot; &amp; CR &amp; _
		&quot;					set b to (do shell script &quot;&quot;rm -f &apos;&quot;&quot; &amp; cout2 &amp; &quot;&quot;&apos;&quot;&quot;)&quot; &amp; CR &amp; _		
		&quot;				end if&quot; &amp; CR &amp; _		
		&quot;				set b to (do shell script &quot;&quot;rm -f &apos;&quot;&quot; &amp; argv1 &amp; &quot;&quot;&apos;&quot;&quot;)&quot; &amp; CR &amp; _		
		&quot;				set argv1 to cout1&quot; &amp; CR &amp; _
		&quot;			end if&quot; &amp; CR &amp; _
		&quot;			theMsg (argv1, myVoice, myLang, &quot;&quot;Purr&quot;&quot;)&quot; &amp; CR &amp; _
		&quot;		end if&quot; &amp; CR &amp; _
		&quot;	on error&quot; &amp; CR &amp; _
		&quot;		set b to (do shell script &quot;&quot;rm -f &quot;&quot; &amp; argv1)&quot; &amp; CR &amp; _
		&quot;		theMsg (err1 &amp; &quot;&quot;: &quot; &amp; fsStringLanguage(9, fsGetLanguage) &amp; &quot;&quot;&quot;, myVoice, myLang, &quot;&quot;Sosumi&quot;&quot;)&quot; &amp; CR &amp; _
		&quot;	end try&quot; &amp; CR &amp; _
		&quot;	set b to (do shell script &quot;&quot;rm -f &apos;&quot;&quot; &amp; myLock &amp; &quot;&quot;&apos;&quot;&quot;)&quot; &amp; CR &amp; _		
		&quot;end run&quot; &amp; CR &amp; _
		&quot;-- ------------------------------------------------------&quot; &amp; CR &amp; _
		&quot;on theMsg(sA, sVoz, myLang, sBeep)&quot; &amp; CR &amp; _
		&quot;	try&quot; &amp; CR &amp; _
		&quot;		display notification sA with title &quot;&quot;Read Text: &quot;&quot; &amp; sVoz &amp; &quot;&quot; (&quot;&quot; &amp; myLang &amp; &quot;&quot;)&quot;&quot; sound name sBeep&quot; &amp; CR &amp; _
		&quot;	end try&quot; &amp; CR &amp; _
		&quot;end theMsg&quot; &amp; CR &amp; _
		&quot;on getExtension(sA)&quot; &amp; CR &amp; _
		&quot;	if sA is &quot;&quot;&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;		set a3 to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	else&quot; &amp; CR &amp; _
		&quot;		set a1 to theSplit(sA, &quot;&quot;.&quot;&quot;)&quot; &amp; CR &amp; _
		&quot;		set s1 to the last item of a1&quot; &amp; CR &amp; _
		&quot;		set a2 to theSplit(s1, &quot;&quot;&apos;&quot;&quot;)&quot; &amp; CR &amp; _
		&quot;		set s2 to first item of a2&quot; &amp; CR &amp; _
		&quot;		set a3 to theSplit(s2, &quot;&quot;\&quot;&quot;&quot;&quot;)&quot; &amp; CR &amp; _
		&quot;		set s3 to first item of a3&quot; &amp; CR &amp; _
		&quot;	end if&quot; &amp; CR &amp; _
		&quot;	return a3 as Unicode text&quot; &amp; CR &amp; _
		&quot;end getExtension&quot; &amp; CR &amp; _
		&quot;on theSplit(theString, theDelimiter)&quot; &amp; CR &amp; _
		&quot;	set oldDelimiters to AppleScript&apos;s text item delimiters&quot; &amp; CR &amp; _
		&quot;	set AppleScript&apos;s text item delimiters to theDelimiter&quot; &amp; CR &amp; _
		&quot;	set theArray to every text item of theString&quot; &amp; CR &amp; _
		&quot;	set AppleScript&apos;s text item delimiters to oldDelimiters&quot; &amp; CR &amp; _
		&quot;	return theArray&quot; &amp; CR &amp; _
		&quot;end theSplit&quot; &amp; CR &amp; _
		&quot;on extractVoice(str0)&quot; &amp; CR &amp; _
		&quot;	set iIndex to offset of &quot;&quot;  &quot;&quot; in str0&quot; &amp; CR &amp; _
		&quot;	return characters 1 thru (iIndex - 1) of str0 as text&quot; &amp; CR &amp; _
		&quot;end extractVoice&quot; &amp; CR &amp; _
		&quot;on isInString(str0, str1)&quot; &amp; CR &amp; _
		&quot;	set retval to true&quot; &amp; CR &amp; _
		&quot;	set iIndex to offset of str1 in str0&quot; &amp; CR &amp; _
		&quot;	if iIndex is 0 then&quot; &amp; CR &amp; _
		&quot;		set retval to false&quot; &amp; CR &amp; _
		&quot;	end if&quot; &amp; CR &amp; _
		&quot;	return retval&quot; &amp; CR &amp; _
		&quot;end isInString&quot; &amp; CR &amp; _
		&quot;on fsChangeCase ( s1 , s2 )&quot; &amp; CR &amp; _
		&quot;	if s2 is &quot;&quot;lower&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;		set s3 to &quot;&quot;A-Z a-z&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	else&quot; &amp; CR &amp; _
		&quot;		set s3 to &quot;&quot;a-z A-Z&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	end if&quot; &amp; CR &amp; _
		&quot;	set s4 to (do shell script &quot;&quot;echo &quot;&quot; &amp; quoted form of ( s1 ) &amp; &quot;&quot; | tr &quot;&quot; &amp; s3 &amp; &quot;&quot; &quot;&quot;)&quot; &amp; CR &amp; _
		&quot;	return s4&quot; &amp; CR &amp; _
		&quot;end fsChangeCase&quot; &amp; CR &amp; _
		&quot;on testTheString(myArray, sLang, sDiv)&quot; &amp; CR &amp; _
		&quot;	set retval to &quot;&quot;&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	if sDiv is &quot;&quot; &quot;&quot; then&quot; &amp; CR &amp; _
		&quot;		set sLang2 to sLang&quot; &amp; CR &amp; _
		&quot;	else&quot; &amp; CR &amp; _
		&quot;		set iIndex to offset of sDiv in sLang&quot; &amp; CR &amp; _
		&quot;		set sLang2 to characters 1 thru (iIndex) of sLang as text&quot; &amp; CR &amp; _
		&quot;	end if&quot; &amp; CR &amp; _
		&quot;	repeat with theItem in myArray&quot; &amp; CR &amp; _
		&quot;		if (isInString(theItem, sLang2)) then&quot; &amp; CR &amp; _
		&quot;			set retval to extractVoice(theItem)&quot; &amp; CR &amp; _
		&quot;			exit repeat&quot; &amp; CR &amp; _
		&quot;		end if&quot; &amp; CR &amp; _
		&quot;	end repeat&quot; &amp; CR &amp; _
		&quot;	return retval&quot; &amp; CR &amp; _
		&quot;end testTheString&quot; &amp; CR &amp; _
		&quot;on fsGetthevoice(sLang)&quot; &amp; CR &amp; _
		&quot;	try&quot; &amp; CR &amp; _
		&quot;		set str0 to (do shell script &quot;&quot;say --voice ?&quot;&quot;)&quot; &amp; CR &amp; _
		&quot;		set myArray to my theSplit(str0, (ASCII character 13))&quot; &amp; CR &amp; _
		&quot;		set retval to testTheString(myArray, sLang, &quot;&quot; &quot;&quot;)&quot; &amp; CR &amp; _
		&quot;		if retval is &quot;&quot;&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;			set retval to testTheString(myArray, sLang, &quot;&quot;_&quot;&quot;)&quot; &amp; CR &amp; _
		&quot;		end if&quot; &amp; CR &amp; _
		&quot;		if retval is &quot;&quot;&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;			set retval to testTheString(myArray, sLang, &quot;&quot;-&quot;&quot;)&quot; &amp; CR &amp; _
		&quot;		end if&quot; &amp; CR &amp; _
		&quot;		if retval is &quot;&quot;&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;			set retval to &quot;&quot;Alex&quot;&quot;&quot; &amp; CR &amp; _
		&quot;		end if&quot; &amp; CR &amp; _
		&quot;	on error&quot; &amp; CR &amp; _
		&quot;		set retval to &quot;&quot;Alex&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	end try&quot; &amp; CR &amp; _
		&quot;	if retval is &quot;&quot;Agnes&quot;&quot; or retval is &quot;&quot;Albert&quot;&quot; or retval is &quot;&quot;&quot;&quot; then&quot; &amp; CR &amp; _
		&quot;		set retval to &quot;&quot;Alex&quot;&quot;&quot; &amp; CR &amp; _
		&quot;	end if&quot; &amp; CR &amp; _
		&quot;	return retval&quot; &amp; CR &amp; _
		&quot;end fsGetthevoice&quot;
	sFile=fsTemporaryTtsAppleScript
	CreateFile(sFile,sB,&quot;utf-8&quot;)
	fswriteOSXSpeechScript = sB
end function

function fsTemporaryTtsAppleScript()
	dim sA as string
	sA=createUnoService(&quot;com.sun.star.util.PathSettings&quot;).userConfig &amp;  &quot;/readaloud.applescript&quot;
	fsTemporaryTtsAppleScript=ConvertFromURL(sA)
end function

function CreateFile(sFilePath, sWriteString, Optional sEncoding)
	&apos; CreateFile (&quot;/tmp/sample.txt&quot;,&quot;Hello world&quot;,&quot;utf-8&quot;) &apos; Best practice
	&apos; CreateFile (&quot;/tmp/sample.txt&quot;,&quot;Hello world&quot;) &apos; is allowed, but not best practice.
	&apos; Windows can not write Asian languages correctly with &quot;iso-8859-15&quot;
	&apos; Anything written for the extension&apos;s private use should be &quot;utf-8&quot;
	&apos; This sub will create the file and all the nested directories
	&apos; in the path in a single step.
	if ismissing(sEncoding) then 
		select case fsGetOS()
		case &quot;WINDOWS&quot;
			sEncoding = &quot;iso-8859-15&quot; &apos;iso-8859-15 is Windows &quot;western&quot; encoding
		case else 
			sEncoding = &quot;utf-8&quot; &apos; Posix standard
		end select
	endif
	on Error goto CreateFileError
 	dim CR as string
	CR = Chr$(13)
	dim oOutputAccess As object
	dim oOutputStream As object
	dim vOutputData, UDP, PV As Variant
	if fileExists (sFilePath) then
		kill sFilePath
	endif
	oOutputAccess = CreateUnoService(&quot;com.sun.star.ucb.SimpleFileAccess&quot;)
	oOutputStream = CreateUnoService(&quot;com.sun.star.io.TextOutputStream&quot;)
	vOutputData   = oOutputAccess.openFileWrite( sFilePath )
	oOutputStream.setOutputStream(vOutputData)
	oOutputStream.setEncoding(sEncoding)
	oOutputStream.writeString( sWriteString )
	oOutputStream.flush()
	oOutputStream.closeOutput()
	CreateFile = true
	exit function
	CreateFileError:
	CreateFile = false
end function

function fbIsAnURL (sA)
	if instr(sA, &quot;http:&quot;) = 1 then
		fbIsAnURL = true
	elseif instr(sA, &quot;ftp:&quot;) = 1 then
		fbIsAnURL = true
	elseif instr(sA, &quot;https:&quot;) = 1 then
		fbIsAnURL = true
	elseif instr(sA, &quot;ftps:&quot;) = 1 then
		fbIsAnURL = true
	elseif instr(sA, &quot;mailto:&quot;) = 1 then
		fbIsAnURL = true
	else
		fbIsAnURL = false
	endif
end function

sub WarnNoSpeech
	on error goto WarnNoSpeechErr
	if (1 = MsgBox(&quot;[espeak] &quot; &amp; fsStringLanguage(15, fsGetLanguage) &amp; Chr$(10) &amp; Chr$(10) &amp; fsStringLanguage(17, fsGetLanguage) &amp; &quot; ...&quot; , 49, fsStringLanguage(0, fsGetLanguage))) then
		select case fsGetOS()
		case &quot;WINDOWS&quot;,&quot;MAC&quot;,&quot;OSX&quot;
			webHelp(&quot;https://sites.google.com/site/readtextextension/&quot;)
		case else
			select case Environ(&quot;DESKTOP_SESSION&quot;)
			case &quot;debian&quot;
				webHelp(&quot;apt:espeak&quot;)
			case &quot;ubuntu&quot;
				webHelp(&quot;apt:libttspico-utils&quot;)
			case else
				webHelp(&quot;https://sites.google.com/site/readtextextension/&quot;)
			end select
		end select		 
	endif
	exit sub
	WarnNoSpeechErr:
	webHelp(&quot;https://sites.google.com/site/readtextextension/&quot;)
end sub

sub CheckUnixSpeech
	&apos; Linux may not include a speech synthesiser by default.
	&apos; Check the first time the application runs.
	if fsGetOS() = &quot;UNIX&quot; then
		if not(fileexists(fsFullPathOf(fsExtensionSettingsIni))) then
			if not(fileexists(&quot;/usr/bin/espeak&quot;)) then
				if not(fileexists(&quot;/usr/bin/festival&quot;)) then
					if not(fileexists(&quot;/usr/bin/pico2wave&quot;)) then
						if not(fileexists(&quot;/usr/bin/spd-say&quot;)) then
							WarnNoSpeech
						endif
					endif
				endif
			endif
		endif
	endif
end sub

function fbHaveFfmpeg
	fbHaveFfmpeg = not (fsMyFfmpeg() =&quot;&quot;) 
end function

function fsMyFfmpeg()

&apos;&apos; ###Miro Video Converter (ffmpeg)
&apos;&apos;
&apos;&apos; Miro Video Converter can convert mp3, ogg, webm and other media using `ffmpeg`
&apos;&apos; Once installed, read text can use it to make audio and video media files
&apos;&apos; for cross-platform web browsers like chromium, chrome, and firefox.
&apos;&apos;
&apos;&apos;  * [ffmpeg](http://https://www.ffmpeg.org)
&apos;&apos;	* [Miro](http://ftp.osuosl.org/pub/pculture.org/miro/)
&apos;&apos;  * [Miro formats](http://develop.participatoryculture.org/index.php/ConversionMatrix)
&apos;&apos;  * [Miro video converter](http://ftp.osuosl.org/pub/pculture.org/mirovideoconverter/)
&apos;&apos;  * [Participatory culture foundation](http://pculture.org/)
&apos;&apos;
&apos;&apos;  The most compact working download is Miro video converter -
&apos;&apos;  (`MiroConvertorSetup.exe`)[http://ftp.osuosl.org/pub/pculture.org/mirovideoconverter/].
&apos;&apos;  (`Miro_openinstall.exe`)[http://ftp.osuosl.org/pub/pculture.org/miro/]
&apos;&apos;  is a (full media manager)[http://www.getmiro.org/] like iTunes.
&apos;&apos;
&apos;&apos; ###avconv
&apos;&apos;
&apos;&apos; On [Ubuntu Linux](http://ubuntu.com), the `avconv` project is included in the repository
&apos;&apos; instead of `ffmpeg`. Read text can use either.

	dim sProgramPaths, sWebURL, cR, sA, sB, sC, sD, sE as string
	dim aC, aD
	dim i as integer
	aC = split(&quot;ffmpeg,avconv&quot;, &quot;,&quot;)
	cR = chr$(10)
	sA = fsProgramDirectory()
	sB = fsProgramDirectoryx86()
	sProgramPaths = &quot;&quot;
	for i = lbound(aC) to ubound(aC)
		sProgramPaths = sProgramPaths &amp; &quot;file:///usr/bin/&quot; &amp; aC(i) &amp; cR &amp; _
		&quot;file:///Applications/Miro.app/Contents/Helpers/&quot; &amp; aC(i) &amp; cR &amp; _
		&quot;file:///Applications/Miro%20Video%20Converter.app/Contents/Helpers/&quot; &amp; aC(i) &amp; cR &amp; _
		&quot;file:///Applications/Shotcut.app/Contents/MacOS/&quot; &amp; aC(i) &amp; cR &amp; _
		converttourl(sA) &amp; &quot;Participatory%20Culture%20Foundation/Miro/ffmpeg/&quot; &amp; aC(i) &amp; &quot;.exe&quot; &amp; cR &amp; _
		converttourl(sB) &amp; &quot;Participatory%20Culture%20Foundation/Miro/ffmpeg/&quot; &amp; aC(i) &amp; &quot;.exe&quot; &amp; cR &amp; _
		converttourl(sA) &amp; &quot;Participatory%20Culture%20Foundation/Miro%20Video%20Converter/ffmpeg/&quot; &amp; aC(i) &amp; &quot;.exe&quot; &amp; cR &amp; _
		converttourl(sB) &amp; &quot;Participatory%20Culture%20Foundation/Miro%20Video%20Converter/ffmpeg/&quot; &amp; aC(i) &amp; &quot;.exe&quot; &amp; cR &amp; _
		&quot;file:///usr/local/bin/&quot; &amp; aC(i) &amp; cR &amp; _
		&quot;file:///opt/&quot; &amp; aC(i) &amp; cR &amp; _
		&quot;file:///opt/local/&quot; &amp; aC(i) &amp; cR &amp; _
		&quot;file:///opt/Shotcut/Shotcut.app/bin/&quot; &amp; aC(i) &amp; cR
		&apos; &quot;---END OF CR SEPARATED LIST---&quot;
	next
	aD= split( fsSuperTrim ( sProgramPaths), cR)
	sE = &quot;&quot;
	for i = lbound(aD) to ubound(aD)
		if fileExists(aD(i)) then
			sE = (aD(i))
			exit for
		endif
	next
	fsMyFfmpeg = convertfromurl(sE)
end function

sub resetSpeechDispatcher(optional bAll as boolean)
	dim errorCode
	dim sTemp
	if isMissing (bAll) then
		&apos; Force stop playing the speech daemon?
		&apos; Speech dispatcher&apos;s problems can often be fixed by shutting
		&apos; down the daemon and forcing it to restart on the next try.
		&apos; Check active processes with gnome-system-monitor 
		bAll = false
	endif
	if fsGetOS()=&quot;OSX&quot; or fsGetOS = &quot;MAC&quot; then
		if fileExists(&quot;/usr/bin/say&quot;) Then
			if not (fbCreatingOSXMediaFile) and not (fbSendingAirPlay) then
				errorCode=Shell(&quot;killall&quot;,0,&quot;say&quot;,true)
			endif
		endif	
	elseif fsGetOS()=&quot;UNIX&quot; then
		if fileExists(&quot;/usr/bin/spd-say&quot;) Then
			if bAll then
					errorCode=Shell(&quot;killall&quot;,0,&quot;speech-dispatcher&quot;,true)
				else
					errorCode=Shell(&quot;spd-say&quot;,0,&quot;--cancel&quot;,true)			
			endif
		endif
		&apos; esdplay paplay &amp; aplay are background sound players that
		&apos; the extension can use to play sounds in Linux.
		if not (fbLetButtonInterruptPosixPlayer) Then
			if fileExists(&quot;/usr/bin/paplay&quot;) Then
				errorCode=Shell(&quot;killall&quot;,0,&quot;paplay&quot;,true)
			endif
			if fileExists(&quot;/usr/bin/esdplay&quot;) Then
				errorCode=Shell(&quot;killall&quot;,0,&quot;esdplay&quot;,true)
			endif
			if fileExists(&quot;/usr/bin/aplay&quot;) Then
				errorCode=Shell(&quot;killall&quot;,0,&quot;aplay&quot;,true)
			endif
		Endif
		if fileExists(&quot;/usr/bin/espeak&quot;) Then
			if not (fbCreatingMediaFile) then
				errorCode=Shell(&quot;killall&quot;,0,&quot;espeak&quot;,true)
			endif
		endif
		if fileExists(fsMyTempLock) Then
			kill fsMyTempLock
		endif	
	endif
end sub

function fbLetButtonInterruptPosixPlayer
	dim b1 as boolean
	b1 = false
	&apos; Don&apos;t interrupt if we are writing a media file
	b1 = fbCreatingMediaFile (&quot;.aif,.aiff,.flac,.m4a,.mp3,.ogg,.wav,.webm&quot;)
	&apos; Don&apos;t interrupt if we are using a graphical player. 
	if fbCreatingMediaFile(&quot;--visible=true,--visible=&apos;true&apos;,--visible=&quot;&quot;true&quot;&quot;&quot;) or _
		not (fbCreatingMediaFile(&quot;--visible=&quot;)) then
		b1 = false
	endif
   fbLetButtonInterruptPosixPlayer = b1
end function

function fbSendingAirPlay
	fbSendingAirPlay = fbCreatingMediaFile (&quot;SAY_APPLESCRIPT_AIRPLAY,airplay&quot;)
end function

function fbCreatingOSXMediaFile
	dim sA as string
	if fbHaveFfmpeg then
		sA = &quot;.mp3,.mp4,.ogg,.wav,.webm,&quot;
	else
		sA = &quot;&quot;
	endif
	fbCreatingOSXMediaFile = fbCreatingMediaFile (sA &amp; &quot;.aiff,.aif,.m4a&quot;)
end function

function fbCreatingMediaFile (optional byval s2)
	&apos; s2 is a csv string of media identifiers- for example, file extensions.
	Dim sFile, s1 as String
	Dim aA
	Dim n as integer
	Dim msgs()As Variant
	Dim errorCode As Integer
	if ismissing(s2) then
		s2 = &quot;.wav&quot;
	endif
	Dim config(fiCountConfigOptions)As Variant
	fbCreatingMediaFile = false
	sFile=fsFullPathOf(fsExtensionSettingsIni)
	tts_config_parseFile(sFile,config(),errorCode)
	s1 = lcase(config(5))
	aA = split (lcase(s2), &quot;,&quot;)
	if len(s1) &lt;&gt; 0 then
		for n = lbound (aA) to ubound (aA)
			if aA(n) = &quot;&quot; then
				exit for
			elseif instr(s1, aA(n)) &gt; 0 then
				fbCreatingMediaFile = true
				exit for
			endif
		next
	endif
end function

function fsThisDocAuthor
	on error goto fsThisDocAuthorErr
	fsThisDocAuthor = ThisComponent.DocumentProperties.Author	
	if len(fsThisDocAuthor) = 0 then
		fsThisDocAuthor = fsStringLanguage(0,fsGetLanguage()) &amp; &quot; &quot; &amp; fsExtensionVersion()
	endif
	exit function
	fsThisDocAuthorErr:
	fsThisDocAuthor = fsStringLanguage(0,fsGetLanguage())
end function

function fsThisDocTitle
	on error goto fsThisDocTitleErr
	dim sA, sB as string
	dim aA, aB
	if not GlobalScope.BasicLibraries.isLibraryLoaded(&quot;Tools&quot;) then 
		GlobalScope.BasicLibraries.loadLibrary(&quot;Tools&quot;)
	endif
	fsThisDocTitle = ThisComponent.DocumentProperties.Title	
	if len(fsThisDocTitle) = 0 then
		sA = ThisComponent.getURL()
		aA = split (sA, &quot;/&quot;)
		sB = convertfromurl (aA(ubound(aA)))
		aB = split (sB, &quot;.&quot;)
		fsThisDocTitle = aB(lbound (aB))
	endif
	exit function
	fsThisDocTitleErr:
	fsThisDocTitle = fsQuickTitle(5)
end function

function fsQuickTitle(optional iWords)
    &apos; Returns the first words of the selected string
    if ismissing (iWords) then
    	iWords = 4
    endif
    on error goto fsQuickTitleErr
	dim s1, s2  as string
	dim a1, a2
	dim n as integer
	s1 = fsGetTextSelection()
	s2 = &quot;&quot;
	a1 = split (s1, &quot; &quot;)
	for n = lbound(a1) to iWords + 1
		s1 = s1 &amp; &quot; .&quot;
	next n
	a2 = split(s1, &quot; &quot;)
	for n = lbound (a2) to iWords - 1
		s2 = s2 &amp; a2(n) &amp; &quot; &quot;
	next
	s2 = fsSuperTrim(s2)
	s2 = fsReplaceText(s2,chr$(13),&quot;&quot;)
	s2 = fsReplaceText(s2,chr$(10),&quot; &quot;)
	s2 = fsReplaceText(s2,chr$(9),&quot;&quot;)
	fsQuickTitle = s2
	exit function
	fsQuickTitleErr:
		fsQuickTitle = &quot;&quot;
end function

</script:module>